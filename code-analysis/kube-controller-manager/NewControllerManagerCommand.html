
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>NewControllerManagerCommand · Kubernetes 学习笔记</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="胡伟煌">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-image-captions/image-captions.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-okaidia.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="deployment-controller.html" />
    
    
    <link rel="prev" href="_index.html" />
    

    
        <link rel="shortcut icon" href='../../images/favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='../../images/favicon.ico' type="image/x-icon">
    
    
        <link rel="apple-touch-icon" href='../../images/favicon.ico'>
    
    
        
        <link rel="apple-touch-icon" sizes="120x120" href="../../images/favicon.ico">
        
        <link rel="apple-touch-icon" sizes="180x180" href="../../images/favicon.ico">
        
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"repo":"huweihuang/kubernetes-notes","types":["star"],"size":"small"};
    </script>


        <!-- https://www.google.com/adsense -->
        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8205636531078391" crossorigin="anonymous"></script>
        
    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://www.huweihuang.com/golang-notes/" target="_blank" class="custom-link">Golang 学习笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/linux-notes/" target="_blank" class="custom-link">Linux 学习笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/blockchain-notes/" target="_blank" class="custom-link">Blockchain 学习笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/data-structure-notes/" target="_blank" class="custom-link">数据结构学习笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/kubernetes-notes/" target="_blank" class="custom-link">Kubernetes 学习笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/k8s-source-code-analysis/" target="_blank" class="custom-link">Kubernetes 源码分析笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/docker-notes/" target="_blank" class="custom-link">Docker 学习笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com/python-notes/" target="_blank" class="custom-link">Python 学习笔记</a>
        </li>
    
        
        <li>
            <a href="https://www.huweihuang.com" target="_blank" class="custom-link">胡伟煌的博客</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        <li class="header">目录</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                        <b>1.1.</b>
                    
                    序言
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">云原生体系</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../paas/12-factor.html">
            
                <a href="../../paas/12-factor.html">
            
                    
                        <b>2.1.</b>
                    
                    12-Factor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../paas/k8s.html">
            
                <a href="../../paas/k8s.html">
            
                    
                        <b>2.2.</b>
                    
                    K8S知识体系
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">安装与配置</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../setup/installer/_index.html">
            
                <a href="../../setup/installer/_index.html">
            
                    
                        <b>3.1.</b>
                    
                    部署k8s集群
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../../setup/installer/install-k8s-by-kubeadm.html">
            
                <a href="../../setup/installer/install-k8s-by-kubeadm.html">
            
                    
                        <b>3.1.1.</b>
                    
                    使用kubeadm安装生产环境kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../../setup/installer/install-k8s-by-kubespray.html">
            
                <a href="../../setup/installer/install-k8s-by-kubespray.html">
            
                    
                        <b>3.1.2.</b>
                    
                    使用kubespray安装kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../../setup/installer/install-k8s-by-minikube.html">
            
                <a href="../../setup/installer/install-k8s-by-minikube.html">
            
                    
                        <b>3.1.3.</b>
                    
                    使用minikube安装kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="../../setup/installer/install-k8s-by-kind.html">
            
                <a href="../../setup/installer/install-k8s-by-kind.html">
            
                    
                        <b>3.1.4.</b>
                    
                    使用kind安装kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="../../setup/installer/install-dashboard.html">
            
                <a href="../../setup/installer/install-dashboard.html">
            
                    
                        <b>3.1.5.</b>
                    
                    安装k8s dashboard
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../setup/kubeadm-upgrade.html">
            
                <a href="../../setup/kubeadm-upgrade.html">
            
                    
                        <b>3.2.</b>
                    
                    kubeadm升级k8s集群
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../setup/kubeadm-certs.html">
            
                <a href="../../setup/kubeadm-certs.html">
            
                    
                        <b>3.3.</b>
                    
                    kubeadm管理证书
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../../setup/k8s-cert.html">
            
                <a href="../../setup/k8s-cert.html">
            
                    
                        <b>3.4.</b>
                    
                    k8s证书及秘钥
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../../setup/k8s-version-release.html">
            
                <a href="../../setup/k8s-version-release.html">
            
                    
                        <b>3.5.</b>
                    
                    k8s版本说明
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../../setup/k8s-changelog.html">
            
                <a href="../../setup/k8s-changelog.html">
            
                    
                        <b>3.6.</b>
                    
                    k8s版本记录
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">基本概念</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../concepts/architecture/_index.html">
            
                <a href="../../concepts/architecture/_index.html">
            
                    
                        <b>4.1.</b>
                    
                    kubernetes架构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../../concepts/architecture/kubernetes-architecture.html">
            
                <a href="../../concepts/architecture/kubernetes-architecture.html">
            
                    
                        <b>4.1.1.</b>
                    
                    Kubernetes总架构图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="../../concepts/architecture/paas-based-on-docker-and-kubernetes.html">
            
                <a href="../../concepts/architecture/paas-based-on-docker-and-kubernetes.html">
            
                    
                        <b>4.1.2.</b>
                    
                    基于Docker及Kubernetes技术构建容器云（PaaS）平台概述
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../../concepts/object/_index.html">
            
                <a href="../../concepts/object/_index.html">
            
                    
                        <b>4.2.</b>
                    
                    kubernetes对象
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../../concepts/object/understanding-kubernetes-objects.html">
            
                <a href="../../concepts/object/understanding-kubernetes-objects.html">
            
                    
                        <b>4.2.1.</b>
                    
                    理解kubernetes对象
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../../concepts/object/kubernetes-basic-concepts.html">
            
                <a href="../../concepts/object/kubernetes-basic-concepts.html">
            
                    
                        <b>4.2.2.</b>
                    
                    kubernetes常用对象说明
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../../concepts/pod/_index.html">
            
                <a href="../../concepts/pod/_index.html">
            
                    
                        <b>4.3.</b>
                    
                    Pod
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="../../concepts/pod/pod.html">
            
                <a href="../../concepts/pod/pod.html">
            
                    
                        <b>4.3.1.</b>
                    
                    Pod介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="../../concepts/pod/pod-definition.html">
            
                <a href="../../concepts/pod/pod-definition.html">
            
                    
                        <b>4.3.2.</b>
                    
                    Pod定义文件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.3" data-path="../../concepts/pod/pod-lifecycle.html">
            
                <a href="../../concepts/pod/pod-lifecycle.html">
            
                    
                        <b>4.3.3.</b>
                    
                    Pod生命周期
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.4" data-path="../../concepts/pod/pod-probe.html">
            
                <a href="../../concepts/pod/pod-probe.html">
            
                    
                        <b>4.3.4.</b>
                    
                    Pod健康检查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.5" data-path="../../concepts/pod/pod-volume.html">
            
                <a href="../../concepts/pod/pod-volume.html">
            
                    
                        <b>4.3.5.</b>
                    
                    Pod存储卷
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.6" data-path="../../concepts/pod/pod-scheduler.html">
            
                <a href="../../concepts/pod/pod-scheduler.html">
            
                    
                        <b>4.3.6.</b>
                    
                    Pod控制器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.7" data-path="../../concepts/pod/pod-operation.html">
            
                <a href="../../concepts/pod/pod-operation.html">
            
                    
                        <b>4.3.7.</b>
                    
                    Pod伸缩与升级
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../../concepts/configmap/_index.html">
            
                <a href="../../concepts/configmap/_index.html">
            
                    
                        <b>4.4.</b>
                    
                    配置
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" data-path="../../concepts/configmap/pod-configmap.html">
            
                <a href="../../concepts/configmap/pod-configmap.html">
            
                    
                        <b>4.4.1.</b>
                    
                    ConfigMap
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../../concepts/_index.html">
            
                <a href="../../concepts/_index.html">
            
                    
                        <b>4.5.</b>
                    
                    Workload
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">核心原理</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../principle/component/_index.html">
            
                <a href="../../principle/component/_index.html">
            
                    
                        <b>5.1.</b>
                    
                    核心组件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="../../principle/component/kubernetes-core-principle-api-server.html">
            
                <a href="../../principle/component/kubernetes-core-principle-api-server.html">
            
                    
                        <b>5.1.1.</b>
                    
                    Api Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="../../principle/component/kubernetes-core-principle-controller-manager.html">
            
                <a href="../../principle/component/kubernetes-core-principle-controller-manager.html">
            
                    
                        <b>5.1.2.</b>
                    
                    Controller Manager
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="../../principle/component/kubernetes-core-principle-scheduler.html">
            
                <a href="../../principle/component/kubernetes-core-principle-scheduler.html">
            
                    
                        <b>5.1.3.</b>
                    
                    Scheduler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4" data-path="../../principle/component/kubernetes-core-principle-kubelet.html">
            
                <a href="../../principle/component/kubernetes-core-principle-kubelet.html">
            
                    
                        <b>5.1.4.</b>
                    
                    Kubelet
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../../principle/flow/_index.html">
            
                <a href="../../principle/flow/_index.html">
            
                    
                        <b>5.2.</b>
                    
                    流程图
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1" data-path="../../principle/flow/pod-flow.html">
            
                <a href="../../principle/flow/pod-flow.html">
            
                    
                        <b>5.2.1.</b>
                    
                    Pod创建流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.2" data-path="../../principle/flow/pvc-flow.html">
            
                <a href="../../principle/flow/pvc-flow.html">
            
                    
                        <b>5.2.2.</b>
                    
                    PVC创建流程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">容器网络</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../../network/docker-network.html">
            
                <a href="../../network/docker-network.html">
            
                    
                        <b>6.1.</b>
                    
                    Docker网络
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../../network/kubernetes-network.html">
            
                <a href="../../network/kubernetes-network.html">
            
                    
                        <b>6.2.</b>
                    
                    K8S网络
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../../network/pod-dns.html">
            
                <a href="../../network/pod-dns.html">
            
                    
                        <b>6.3.</b>
                    
                    Pod的DNS策略
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="../../network/flannel/_index.html">
            
                <a href="../../network/flannel/_index.html">
            
                    
                        <b>6.4.</b>
                    
                    网络插件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.4.1" data-path="../../network/flannel/flannel-introduction.html">
            
                <a href="../../network/flannel/flannel-introduction.html">
            
                    
                        <b>6.4.1.</b>
                    
                    Flannel介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="../../network/cni/_index.html">
            
                <a href="../../network/cni/_index.html">
            
                    
                        <b>6.5.</b>
                    
                    CNI
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.5.1" data-path="../../network/cni/cni.html">
            
                <a href="../../network/cni/cni.html">
            
                    
                        <b>6.5.1.</b>
                    
                    CNI接口介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5.2" data-path="../../network/cni/macvlan.html">
            
                <a href="../../network/cni/macvlan.html">
            
                    
                        <b>6.5.2.</b>
                    
                    Macvlan介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">容器存储</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../../storage/volume/_index.html">
            
                <a href="../../storage/volume/_index.html">
            
                    
                        <b>7.1.</b>
                    
                    存储卷概念
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1.1" data-path="../../storage/volume/volume.html">
            
                <a href="../../storage/volume/volume.html">
            
                    
                        <b>7.1.1.</b>
                    
                    Volume
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.2" data-path="../../storage/volume/persistent-volume.html">
            
                <a href="../../storage/volume/persistent-volume.html">
            
                    
                        <b>7.1.2.</b>
                    
                    Persistent Volume
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.3" data-path="../../storage/volume/persistent-volume-claim.html">
            
                <a href="../../storage/volume/persistent-volume-claim.html">
            
                    
                        <b>7.1.3.</b>
                    
                    Persistent Volume Claim
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.4" data-path="../../storage/volume/storage-class.html">
            
                <a href="../../storage/volume/storage-class.html">
            
                    
                        <b>7.1.4.</b>
                    
                    Storage Class
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.1.5" data-path="../../storage/volume/dynamic-provisioning.html">
            
                <a href="../../storage/volume/dynamic-provisioning.html">
            
                    
                        <b>7.1.5.</b>
                    
                    Dynamic Volume Provisioning
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../../storage/csi/_index.html">
            
                <a href="../../storage/csi/_index.html">
            
                    
                        <b>7.2.</b>
                    
                    CSI
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.2.1" data-path="../../storage/csi/ceph/csi-cephfs-plugin.html">
            
                <a href="../../storage/csi/ceph/csi-cephfs-plugin.html">
            
                    
                        <b>7.2.1.</b>
                    
                    csi-cephfs-plugin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2.2" data-path="../../storage/csi/ceph/deploy-csi-cephfs.html">
            
                <a href="../../storage/csi/ceph/deploy-csi-cephfs.html">
            
                    
                        <b>7.2.2.</b>
                    
                    部署csi-cephfs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2.3" data-path="../../storage/csi/provisioner/cephfs-provisioner.html">
            
                <a href="../../storage/csi/provisioner/cephfs-provisioner.html">
            
                    
                        <b>7.2.3.</b>
                    
                    部署cephfs-provisioner
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2.4" data-path="../../storage/csi/flexvolume.html">
            
                <a href="../../storage/csi/flexvolume.html">
            
                    
                        <b>7.2.4.</b>
                    
                    FlexVolume介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">资源隔离</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../../resource/resource-quota.html">
            
                <a href="../../resource/resource-quota.html">
            
                    
                        <b>8.1.</b>
                    
                    资源配额
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="../../resource/limit-range.html">
            
                <a href="../../resource/limit-range.html">
            
                    
                        <b>8.2.</b>
                    
                    Pod限额
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="../../resource/quality-of-service.html">
            
                <a href="../../resource/quality-of-service.html">
            
                    
                        <b>8.3.</b>
                    
                    资源服务质量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="../../resource/lxcfs/lxcfs.html">
            
                <a href="../../resource/lxcfs/lxcfs.html">
            
                    
                        <b>8.4.</b>
                    
                    Lxcfs资源视图隔离
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">运维指南</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="../../operation/kubernetes-troubleshooting.html">
            
                <a href="../../operation/kubernetes-troubleshooting.html">
            
                    
                        <b>9.1.</b>
                    
                    kubernetes集群问题排查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="../../operation/kubectl/_index.html">
            
                <a href="../../operation/kubectl/_index.html">
            
                    
                        <b>9.2.</b>
                    
                    kubectl工具
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.2.1" data-path="../../operation/kubectl/install-kubectl.html">
            
                <a href="../../operation/kubectl/install-kubectl.html">
            
                    
                        <b>9.2.1.</b>
                    
                    kubectl安装与配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2.2" data-path="../../operation/kubectl/kubectl-commands.html">
            
                <a href="../../operation/kubectl/kubectl-commands.html">
            
                    
                        <b>9.2.2.</b>
                    
                    kubectl命令说明
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2.3" data-path="../../operation/kubectl/kubectl-alias.html">
            
                <a href="../../operation/kubectl/kubectl-alias.html">
            
                    
                        <b>9.2.3.</b>
                    
                    kubectl命令别名
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2.4" data-path="../../operation/kubectl/kubectl-node-shell.html">
            
                <a href="../../operation/kubectl/kubectl-node-shell.html">
            
                    
                        <b>9.2.4.</b>
                    
                    kubectl进入node shell
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="../../operation/helm/_index.html">
            
                <a href="../../operation/helm/_index.html">
            
                    
                        <b>9.3.</b>
                    
                    helm工具
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.3.1" data-path="../../operation/helm/helm-usage.html">
            
                <a href="../../operation/helm/helm-usage.html">
            
                    
                        <b>9.3.1.</b>
                    
                    helm的使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9.4" data-path="../../operation/node/_index.html">
            
                <a href="../../operation/node/_index.html">
            
                    
                        <b>9.4.</b>
                    
                    节点迁移
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.4.1" data-path="../../operation/node/safely-drain-node.html">
            
                <a href="../../operation/node/safely-drain-node.html">
            
                    
                        <b>9.4.1.</b>
                    
                    安全迁移节点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.4.2" data-path="../../operation/node/nodeselector-and-taint.html">
            
                <a href="../../operation/node/nodeselector-and-taint.html">
            
                    
                        <b>9.4.2.</b>
                    
                    指定Node调度与隔离
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9.5" data-path="../../operation/registry/_index.html">
            
                <a href="../../operation/registry/_index.html">
            
                    
                        <b>9.5.</b>
                    
                    镜像仓库
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.5.1" data-path="../../operation/registry/config-private-registry.html">
            
                <a href="../../operation/registry/config-private-registry.html">
            
                    
                        <b>9.5.1.</b>
                    
                    配置私有的镜像仓库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.5.2" data-path="../../operation/registry/ImagePullSecrets.html">
            
                <a href="../../operation/registry/ImagePullSecrets.html">
            
                    
                        <b>9.5.2.</b>
                    
                    拉取私有镜像
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9.6" data-path="../../operation/access/_index.html">
            
                <a href="../../operation/access/_index.html">
            
                    
                        <b>9.6.</b>
                    
                    访问控制
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.6.1" data-path="../../operation/access/rbac-auth.html">
            
                <a href="../../operation/access/rbac-auth.html">
            
                    
                        <b>9.6.1.</b>
                    
                    使用RBAC鉴权
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9.7" data-path="../../operation/deployment/_index.html">
            
                <a href="../../operation/deployment/_index.html">
            
                    
                        <b>9.7.</b>
                    
                    版本发布
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.7.1" data-path="../../operation/deployment/canary-deployment.html">
            
                <a href="../../operation/deployment/canary-deployment.html">
            
                    
                        <b>9.7.1.</b>
                    
                    金丝雀发布
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">开发指南</li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="../../develop/client-go.html">
            
                <a href="../../develop/client-go.html">
            
                    
                        <b>10.1.</b>
                    
                    client-go的使用及源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="../../develop/csi/_index.html">
            
                <a href="../../develop/csi/_index.html">
            
                    
                        <b>10.2.</b>
                    
                    CSI插件开发
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.2.1" data-path="../../develop/csi/nfs-client-provisioner.html">
            
                <a href="../../develop/csi/nfs-client-provisioner.html">
            
                    
                        <b>10.2.1.</b>
                    
                    nfs-client-provisioner源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.2.2" data-path="../../develop/csi/csi-provisioner.html">
            
                <a href="../../develop/csi/csi-provisioner.html">
            
                    
                        <b>10.2.2.</b>
                    
                    csi-provisioner源码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10.3" data-path="../../develop/operator/_index.html">
            
                <a href="../../develop/operator/_index.html">
            
                    
                        <b>10.3.</b>
                    
                    operator开发
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.3.1" data-path="../../develop/operator/kubebuilder.html">
            
                <a href="../../develop/operator/kubebuilder.html">
            
                    
                        <b>10.3.1.</b>
                    
                    kubebuilder的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.3.2" data-path="../../develop/operator/develop-operator.html">
            
                <a href="../../develop/operator/develop-operator.html">
            
                    
                        <b>10.3.2.</b>
                    
                    如何开发一个Operator
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10.4" data-path="../../develop/develop-k8s.html">
            
                <a href="../../develop/develop-k8s.html">
            
                    
                        <b>10.4.</b>
                    
                    k8s社区开发指南
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">问题排查</li>
        
        
    
        <li class="chapter " data-level="11.1" data-path="../../trouble-shooting/node/_index.html">
            
                <a href="../../trouble-shooting/node/_index.html">
            
                    
                        <b>11.1.</b>
                    
                    节点相关问题
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="11.1.1" data-path="../../trouble-shooting/node/keycreate-permission-denied.html">
            
                <a href="../../trouble-shooting/node/keycreate-permission-denied.html">
            
                    
                        <b>11.1.1.</b>
                    
                    keycreate permission denied
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.1.2" data-path="../../trouble-shooting/node/cgroup-pid-error.html">
            
                <a href="../../trouble-shooting/node/cgroup-pid-error.html">
            
                    
                        <b>11.1.2.</b>
                    
                    Cgroup不支持pid资源
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.1.3" data-path="../../trouble-shooting/node/cgroup-subsystem-not-mount.html">
            
                <a href="../../trouble-shooting/node/cgroup-subsystem-not-mount.html">
            
                    
                        <b>11.1.3.</b>
                    
                    Cgroup子系统无法挂载
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="11.2" data-path="../../trouble-shooting/pod-evicted.html">
            
                <a href="../../trouble-shooting/pod-evicted.html">
            
                    
                        <b>11.2.</b>
                    
                    Pod驱逐
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.3" data-path="../../trouble-shooting/pod-image-error.html">
            
                <a href="../../trouble-shooting/pod-image-error.html">
            
                    
                        <b>11.3.</b>
                    
                    镜像拉取失败问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="11.4" data-path="../../trouble-shooting/pvc-terminating.html">
            
                <a href="../../trouble-shooting/pvc-terminating.html">
            
                    
                        <b>11.4.</b>
                    
                    PVC Terminating
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">源码分析</li>
        
        
    
        <li class="chapter " data-level="12.1" data-path="../code-analysis-notes.html">
            
                <a href="../code-analysis-notes.html">
            
                    
                        <b>12.1.</b>
                    
                    Kubernetes源码分析笔记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.2" data-path="../kubelet/_index.html">
            
                <a href="../kubelet/_index.html">
            
                    
                        <b>12.2.</b>
                    
                    kubelet
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="12.2.1" data-path="../kubelet/NewKubeletCommand.html">
            
                <a href="../kubelet/NewKubeletCommand.html">
            
                    
                        <b>12.2.1.</b>
                    
                    NewKubeletCommand
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.2.2" data-path="../kubelet/NewMainKubelet.html">
            
                <a href="../kubelet/NewMainKubelet.html">
            
                    
                        <b>12.2.2.</b>
                    
                    NewMainKubelet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.2.3" data-path="../kubelet/startKubelet.html">
            
                <a href="../kubelet/startKubelet.html">
            
                    
                        <b>12.2.3.</b>
                    
                    startKubelet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.2.4" data-path="../kubelet/syncLoopIteration.html">
            
                <a href="../kubelet/syncLoopIteration.html">
            
                    
                        <b>12.2.4.</b>
                    
                    syncLoopIteration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.2.5" data-path="../kubelet/syncPod.html">
            
                <a href="../kubelet/syncPod.html">
            
                    
                        <b>12.2.5.</b>
                    
                    syncPod
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="12.3" data-path="_index.html">
            
                <a href="_index.html">
            
                    
                        <b>12.3.</b>
                    
                    kube-controller-manager
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="12.3.1" data-path="NewControllerManagerCommand.html">
            
                <a href="NewControllerManagerCommand.html">
            
                    
                        <b>12.3.1.</b>
                    
                    NewControllerManagerCommand
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.3.2" data-path="deployment-controller.html">
            
                <a href="deployment-controller.html">
            
                    
                        <b>12.3.2.</b>
                    
                    DeploymentController
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.3.3" data-path="sharedIndexInformer.html">
            
                <a href="sharedIndexInformer.html">
            
                    
                        <b>12.3.3.</b>
                    
                    Informer机制
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="12.4" data-path="../kube-scheduler/_index.html">
            
                <a href="../kube-scheduler/_index.html">
            
                    
                        <b>12.4.</b>
                    
                    kube-scheduler
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="12.4.1" data-path="../kube-scheduler/NewSchedulerCommand.html">
            
                <a href="../kube-scheduler/NewSchedulerCommand.html">
            
                    
                        <b>12.4.1.</b>
                    
                    NewSchedulerCommand
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.4.2" data-path="../kube-scheduler/registerAlgorithmProvider.html">
            
                <a href="../kube-scheduler/registerAlgorithmProvider.html">
            
                    
                        <b>12.4.2.</b>
                    
                    registerAlgorithmProvider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.4.3" data-path="../kube-scheduler/scheduleOne.html">
            
                <a href="../kube-scheduler/scheduleOne.html">
            
                    
                        <b>12.4.3.</b>
                    
                    scheduleOne
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.4.4" data-path="../kube-scheduler/findNodesThatFit.html">
            
                <a href="../kube-scheduler/findNodesThatFit.html">
            
                    
                        <b>12.4.4.</b>
                    
                    findNodesThatFit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.4.5" data-path="../kube-scheduler/PrioritizeNodes.html">
            
                <a href="../kube-scheduler/PrioritizeNodes.html">
            
                    
                        <b>12.4.5.</b>
                    
                    PrioritizeNodes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="12.4.6" data-path="../kube-scheduler/preempt.html">
            
                <a href="../kube-scheduler/preempt.html">
            
                    
                        <b>12.4.6.</b>
                    
                    preempt
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="12.5" data-path="../kube-apiserver/_index.html">
            
                <a href="../kube-apiserver/_index.html">
            
                    
                        <b>12.5.</b>
                    
                    kube-apiserver
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="12.5.1" data-path="../kube-apiserver/NewAPIServerCommand.html">
            
                <a href="../kube-apiserver/NewAPIServerCommand.html">
            
                    
                        <b>12.5.1.</b>
                    
                    NewAPIServerCommand
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Runtime</li>
        
        
    
        <li class="chapter " data-level="13.1" data-path="../../runtime/_index.html">
            
                <a href="../../runtime/_index.html">
            
                    
                        <b>13.1.</b>
                    
                    Runtime
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="13.1.1" data-path="../../runtime/runtime.html">
            
                <a href="../../runtime/runtime.html">
            
                    
                        <b>13.1.1.</b>
                    
                    Runc和Containerd概述
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="13.2" data-path="../../runtime/containerd/_index.html">
            
                <a href="../../runtime/containerd/_index.html">
            
                    
                        <b>13.2.</b>
                    
                    Containerd
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="13.2.1" data-path="../../runtime/containerd/install-containerd.html">
            
                <a href="../../runtime/containerd/install-containerd.html">
            
                    
                        <b>13.2.1.</b>
                    
                    安装Containerd
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="13.3" data-path="../../runtime/docker/_index.html">
            
                <a href="../../runtime/docker/_index.html">
            
                    
                        <b>13.3.</b>
                    
                    Docker
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="13.3.1" data-path="../../runtime/docker/docker-notes.html">
            
                <a href="../../runtime/docker/docker-notes.html">
            
                    
                        <b>13.3.1.</b>
                    
                    Docker学习笔记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="13.4" data-path="../../runtime/kata/_index.html">
            
                <a href="../../runtime/kata/_index.html">
            
                    
                        <b>13.4.</b>
                    
                    Kata Container
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="13.4.1" data-path="../../runtime/kata/kata-container.html">
            
                <a href="../../runtime/kata/kata-container.html">
            
                    
                        <b>13.4.1.</b>
                    
                    kata容器简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="13.4.2" data-path="../../runtime/kata/kata-container-conf.html">
            
                <a href="../../runtime/kata/kata-container-conf.html">
            
                    
                        <b>13.4.2.</b>
                    
                    kata配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="13.5" data-path="../../runtime/gpu/_index.html">
            
                <a href="../../runtime/gpu/_index.html">
            
                    
                        <b>13.5.</b>
                    
                    GPU
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="13.5.1" data-path="../../runtime/gpu/nvidia-device-plugin.html">
            
                <a href="../../runtime/gpu/nvidia-device-plugin.html">
            
                    
                        <b>13.5.1.</b>
                    
                    nvidia-device-plugin介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Etcd</li>
        
        
    
        <li class="chapter " data-level="14.1" data-path="../../etcd/etcd-introduction.html">
            
                <a href="../../etcd/etcd-introduction.html">
            
                    
                        <b>14.1.</b>
                    
                    Etcd介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="14.2" data-path="../../etcd/raft.html">
            
                <a href="../../etcd/raft.html">
            
                    
                        <b>14.2.</b>
                    
                    Raft算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="14.3" data-path="../../etcd/etcd-setup-flags.html">
            
                <a href="../../etcd/etcd-setup-flags.html">
            
                    
                        <b>14.3.</b>
                    
                    Etcd启动配置参数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="14.4" data-path="../../etcd/etcd-auth-and-security.html">
            
                <a href="../../etcd/etcd-auth-and-security.html">
            
                    
                        <b>14.4.</b>
                    
                    Etcd访问控制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="14.5" data-path="../../etcd/etcdctl/_index.html">
            
                <a href="../../etcd/etcdctl/_index.html">
            
                    
                        <b>14.5.</b>
                    
                    etcdctl命令工具
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="14.5.1" data-path="../../etcd/etcdctl/etcdctl-v3.html">
            
                <a href="../../etcd/etcdctl/etcdctl-v3.html">
            
                    
                        <b>14.5.1.</b>
                    
                    etcdctl命令工具-V3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="14.5.2" data-path="../../etcd/etcdctl/etcdctl-v2.html">
            
                <a href="../../etcd/etcdctl/etcdctl-v2.html">
            
                    
                        <b>14.5.2.</b>
                    
                    etcdctl命令工具-V2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="14.6" data-path="../../etcd/k8s-etcd-data.html">
            
                <a href="../../etcd/k8s-etcd-data.html">
            
                    
                        <b>14.6.</b>
                    
                    Etcd中的k8s数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="14.7" data-path="../../etcd/etcd-operator-usage.html">
            
                <a href="../../etcd/etcd-operator-usage.html">
            
                    
                        <b>14.7.</b>
                    
                    Etcd-Operator的使用
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">多集群管理</li>
        
        
    
        <li class="chapter " data-level="15.1" data-path="../../multi-cluster/k8s-multi-cluster-thinking.html">
            
                <a href="../../multi-cluster/k8s-multi-cluster-thinking.html">
            
                    
                        <b>15.1.</b>
                    
                    k8s多集群管理的思考
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="15.2" data-path="../../multi-cluster/virtual-kubelet/_index.html">
            
                <a href="../../multi-cluster/virtual-kubelet/_index.html">
            
                    
                        <b>15.2.</b>
                    
                    Virtual Kubelet
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="15.2.1" data-path="../../multi-cluster/virtual-kubelet/virtual-kubelet.html">
            
                <a href="../../multi-cluster/virtual-kubelet/virtual-kubelet.html">
            
                    
                        <b>15.2.1.</b>
                    
                    Virtual Kubelet介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="15.2.2" data-path="../../multi-cluster/virtual-kubelet/virtual-kubelet-cmd.html">
            
                <a href="../../multi-cluster/virtual-kubelet/virtual-kubelet-cmd.html">
            
                    
                        <b>15.2.2.</b>
                    
                    Virtual Kubelet 命令
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="15.3" data-path="../../multi-cluster/karmada/_index.html">
            
                <a href="../../multi-cluster/karmada/_index.html">
            
                    
                        <b>15.3.</b>
                    
                    Karmada
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="15.3.1" data-path="../../multi-cluster/karmada/karmada-introduction.html">
            
                <a href="../../multi-cluster/karmada/karmada-introduction.html">
            
                    
                        <b>15.3.1.</b>
                    
                    Karmada介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">边缘容器</li>
        
        
    
        <li class="chapter " data-level="16.1" data-path="../../edge/kubeedge/kubeedge-arch.html">
            
                <a href="../../edge/kubeedge/kubeedge-arch.html">
            
                    
                        <b>16.1.</b>
                    
                    KubeEdge介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="16.2" data-path="../../edge/kubeedge/code-analysis/_index.html">
            
                <a href="../../edge/kubeedge/code-analysis/_index.html">
            
                    
                        <b>16.2.</b>
                    
                    KubeEdge源码分析
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="16.2.1" data-path="../../edge/kubeedge/code-analysis/cloudcore.html">
            
                <a href="../../edge/kubeedge/code-analysis/cloudcore.html">
            
                    
                        <b>16.2.1.</b>
                    
                    cloudcore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="16.2.2" data-path="../../edge/kubeedge/code-analysis/edgecore.html">
            
                <a href="../../edge/kubeedge/code-analysis/edgecore.html">
            
                    
                        <b>16.2.2.</b>
                    
                    edgecore
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="16.3" data-path="../../edge/openyurt/_index.html">
            
                <a href="../../edge/openyurt/_index.html">
            
                    
                        <b>16.3.</b>
                    
                    OpenYurt
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="16.3.1" data-path="../../edge/openyurt/install-openyurt.html">
            
                <a href="../../edge/openyurt/install-openyurt.html">
            
                    
                        <b>16.3.1.</b>
                    
                    OpenYurt部署
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="16.3.2" data-path="../../edge/openyurt/update-k8s-for-openyurt.html">
            
                <a href="../../edge/openyurt/update-k8s-for-openyurt.html">
            
                    
                        <b>16.3.2.</b>
                    
                    OpenYurt部署之调整k8s配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="16.4" data-path="../../edge/openyurt/code-analysis/_index.html">
            
                <a href="../../edge/openyurt/code-analysis/_index.html">
            
                    
                        <b>16.4.</b>
                    
                    OpenYurt源码分析
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="16.4.1" data-path="../../edge/openyurt/code-analysis/yurthub-code-analysis-1.html">
            
                <a href="../../edge/openyurt/code-analysis/yurthub-code-analysis-1.html">
            
                    
                        <b>16.4.1.</b>
                    
                    YurtHub源码分析（1)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="16.4.2" data-path="../../edge/openyurt/code-analysis/tunnel-server-code-analysis.html">
            
                <a href="../../edge/openyurt/code-analysis/tunnel-server-code-analysis.html">
            
                    
                        <b>16.4.2.</b>
                    
                    TunnelServer源码分析（1）
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="16.4.3" data-path="../../edge/openyurt/code-analysis/tennel-agent-code-analysis.html">
            
                <a href="../../edge/openyurt/code-analysis/tennel-agent-code-analysis.html">
            
                    
                        <b>16.4.3.</b>
                    
                    Tunnel-Agent源码分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">虚拟化</li>
        
        
    
        <li class="chapter " data-level="17.1" data-path="../../kvm/vm-concept.html">
            
                <a href="../../kvm/vm-concept.html">
            
                    
                        <b>17.1.</b>
                    
                    虚拟化相关概念
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="17.2" data-path="../../kvm/kubevirt/_index.html">
            
                <a href="../../kvm/kubevirt/_index.html">
            
                    
                        <b>17.2.</b>
                    
                    KubeVirt
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="17.2.1" data-path="../../kvm/kubevirt/kubevirt-introduction.html">
            
                <a href="../../kvm/kubevirt/kubevirt-introduction.html">
            
                    
                        <b>17.2.1.</b>
                    
                    KubeVirt的介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="17.2.2" data-path="../../kvm/kubevirt/kubevirt-installation.html">
            
                <a href="../../kvm/kubevirt/kubevirt-installation.html">
            
                    
                        <b>17.2.2.</b>
                    
                    KubeVirt的使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">监控体系</li>
        
        
    
        <li class="chapter " data-level="18.1" data-path="../../monitor/kubernetes-cluster-monitoring.html">
            
                <a href="../../monitor/kubernetes-cluster-monitoring.html">
            
                    
                        <b>18.1.</b>
                    
                    监控体系介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="18.2" data-path="../../monitor/kube-promethus-stack.html">
            
                <a href="../../monitor/kube-promethus-stack.html">
            
                    
                        <b>18.2.</b>
                    
                    kube-prometheus-stack的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="18.3" data-path="../../monitor/cadvisor-introduction.html">
            
                <a href="../../monitor/cadvisor-introduction.html">
            
                    
                        <b>18.3.</b>
                    
                    cAdvisor介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="18.4" data-path="../../monitor/heapster-introduction.html">
            
                <a href="../../monitor/heapster-introduction.html">
            
                    
                        <b>18.4.</b>
                    
                    Heapster介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="18.5" data-path="../../monitor/influxdb-introduction.html">
            
                <a href="../../monitor/influxdb-introduction.html">
            
                    
                        <b>18.5.</b>
                    
                    Influxdb介绍
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            本书使用 GitBook 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >NewControllerManagerCommand</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                
                <div id="vip-container">
                    <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#kube-controller-manager&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF08;&#x4E00;&#xFF09;&#x4E4B;-newcontrollermanagercommand"><b></b>kube-controller-manager&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF08;&#x4E00;&#xFF09;&#x4E4B; NewControllerManagerCommand</a></li><li><span class="title-icon "></span><a href="#1-main&#x51FD;&#x6570;"><b></b>1. Main&#x51FD;&#x6570;</a></li><li><span class="title-icon "></span><a href="#2-newcontrollermanagercommand"><b></b>2. NewControllerManagerCommand</a></li><ul><li><span class="title-icon "></span><a href="#21-newkubecontrollermanageroptions"><b></b>2.1. NewKubeControllerManagerOptions</a></li><li><span class="title-icon "></span><a href="#22-addflagset"><b></b>2.2. AddFlagSet</a></li></ul><li><span class="title-icon "></span><a href="#3-run"><b></b>3. Run</a></li><ul><li><span class="title-icon "></span><a href="#31-createcontrollercontext"><b></b>3.1. CreateControllerContext</a></li><li><span class="title-icon "></span><a href="#32-newcontrollerinitializers"><b></b>3.2. NewControllerInitializers</a></li><li><span class="title-icon "></span><a href="#33-startcontrollers"><b></b>3.3. StartControllers</a></li><li><span class="title-icon "></span><a href="#34-informerfactorystart"><b></b>3.4. InformerFactory.Start</a></li><ul><li><span class="title-icon "></span><a href="#341-sharedinformerfactory"><b></b>3.4.1. SharedInformerFactory</a></li><li><span class="title-icon "></span><a href="#342-sharedinformerfactorystart"><b></b>3.4.2. sharedInformerFactory.Start</a></li><li><span class="title-icon "></span><a href="#343-sharedindexinformerrun"><b></b>3.4.3. sharedIndexInformer.Run</a></li></ul></ul><li><span class="title-icon "></span><a href="#4-initfnctx"><b></b>4. initFn(ctx)</a></li><ul><li><span class="title-icon "></span><a href="#41-startstatefulsetcontroller"><b></b>4.1. startStatefulSetController</a></li><li><span class="title-icon "></span><a href="#42-startdeploymentcontroller"><b></b>4.2. startDeploymentController</a></li></ul><li><span class="title-icon "></span><a href="#5-&#x603B;&#x7ED3;"><b></b>5. &#x603B;&#x7ED3;</a></li></ul></div><a href="#kube-controller-manager&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF08;&#x4E00;&#xFF09;&#x4E4B;-newcontrollermanagercommand" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="kube-controller-manager&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF08;&#x4E00;&#xFF09;&#x4E4B;-newcontrollermanagercommand"><a name="kube-controller-manager&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF08;&#x4E00;&#xFF09;&#x4E4B;-newcontrollermanagercommand" class="anchor-navigation-ex-anchor" href="#kube-controller-manager&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF08;&#x4E00;&#xFF09;&#x4E4B;-newcontrollermanagercommand"><i class="fa fa-link" aria-hidden="true"></i></a>kube-controller-manager&#x6E90;&#x7801;&#x5206;&#x6790;&#xFF08;&#x4E00;&#xFF09;&#x4E4B; NewControllerManagerCommand</h1>
<blockquote>
<p>&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x5206;&#x6790;&#x57FA;&#x4E8E; <code>kubernetes v1.12.0</code> &#x7248;&#x672C;&#x3002;</p>
<p>&#x672C;&#x6587;&#x4E3B;&#x8981;&#x5206;&#x6790;<a href="https://github.com/kubernetes/kubernetes/tree/v1.12.0/cmd/kube-controller-manager" target="_blank">https://github.com/kubernetes/kubernetes/tree/v1.12.0/cmd/kube-controller-manager</a> &#x90E8;&#x5206;&#x7684;&#x4EE3;&#x7801;&#x3002;</p>
</blockquote>
<p>&#x672C;&#x6587;&#x4E3B;&#x8981;&#x5206;&#x6790; <code>kubernetes/cmd/kube-controller-manager</code>&#x90E8;&#x5206;&#xFF0C;&#x8BE5;&#x90E8;&#x5206;&#x4E3B;&#x8981;&#x6D89;&#x53CA;&#x5404;&#x79CD;&#x7C7B;&#x578B;&#x7684;<code>controller</code>&#x7684;&#x53C2;&#x6570;&#x89E3;&#x6790;&#xFF0C;&#x53CA;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4F8B;&#x5982; <code>deployment controller</code> &#x548C;<code>statefulset controller</code>&#x3002;&#x5E76;&#x6CA1;&#x6709;&#x5177;&#x4F53;<code>controller</code>&#x8FD0;&#x884C;&#x7684;&#x8BE6;&#x7EC6;&#x903B;&#x8F91;&#xFF0C;&#x8BE5;&#x90E8;&#x5206;&#x4F4D;&#x4E8E;<code>kubernetes/pkg/controller</code>&#x6A21;&#x5757;&#xFF0C;&#x5F85;&#x540E;&#x7EED;&#x6587;&#x7AE0;&#x5206;&#x6790;&#x3002;</p>
<p><code>kube-controller-manager</code>&#x7684;<code>cmd</code>&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x76EE;&#x5F55;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-bash">kube-controller-manager
&#x251C;&#x2500;&#x2500; app
&#x2502;   &#x251C;&#x2500;&#x2500; apps.go   <span class="token comment"># &#x5305;&#x542B;:startDeploymentController&#x3001;startReplicaSetController&#x3001;startStatefulSetController&#x3001;startDaemonSetController</span>
&#x2502;   &#x251C;&#x2500;&#x2500; autoscaling.go <span class="token comment"># startHPAController</span>
&#x2502;   &#x251C;&#x2500;&#x2500; batch.go  <span class="token comment"># startJobController&#x3001;startCronJobController</span>
&#x2502;   &#x251C;&#x2500;&#x2500; bootstrap.go
&#x2502;   &#x251C;&#x2500;&#x2500; certificates.go
&#x2502;   &#x251C;&#x2500;&#x2500; cloudproviders.go
&#x2502;   &#x251C;&#x2500;&#x2500; config
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; config.go   <span class="token comment"># config: controller manager&#x6267;&#x884C;&#x7684;&#x4E0A;&#x4E0B;&#x6587;</span>
&#x2502;   &#x251C;&#x2500;&#x2500; controllermanager.go   <span class="token comment"># &#x5305;&#x542B;:NewControllerManagerCommand&#x3001;Run&#x3001;NewControllerInitializers&#x3001;StartControllers&#x7B49;</span>
&#x2502;   &#x251C;&#x2500;&#x2500; core.go   <span class="token comment"># startServiceController&#x3001;startNodeIpamController&#x3001;startPersistentVolumeBinderController&#x3001;startNamespaceController&#x7B49;</span>
&#x2502;   &#x251C;&#x2500;&#x2500; options    <span class="token comment"># &#x5305;&#x542B;&#x4E0D;&#x540C;controller&#x7684;option&#x53C2;&#x6570;</span>
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; attachdetachcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; csrsigningcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; daemonsetcontroller.go   <span class="token comment"># DaemonSetControllerOptions</span>
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; deploymentcontroller.go  <span class="token comment"># DeploymentControllerOptions</span>
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; deprecatedcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; endpointcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; garbagecollectorcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; hpacontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; jobcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; namespacecontroller.go   <span class="token comment"># NamespaceControllerOptions</span>
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; nodeipamcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; nodelifecyclecontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; options.go  <span class="token comment"># KubeControllerManagerOptions&#x3001;NewKubeControllerManagerOptions</span>
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; persistentvolumebindercontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; podgccontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; replicasetcontroller.go   <span class="token comment"># ReplicaSetControllerOptions</span>
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; replicationcontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; resourcequotacontroller.go
&#x2502;   &#x2502;   &#x251C;&#x2500;&#x2500; serviceaccountcontroller.go
&#x2502;   &#x2502;   &#x2514;&#x2500;&#x2500; ttlafterfinishedcontroller.go
&#x2514;&#x2500;&#x2500; controller-manager.go  <span class="token comment"># main&#x5165;&#x53E3;&#x51FD;&#x6570;</span>
</code></pre>
<h1 id="1-main&#x51FD;&#x6570;"><a name="1-main&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#1-main&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>1. <a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/controller-manager.go#L41" target="_blank">Main&#x51FD;&#x6570;</a></h1>
<p><code>kube-controller-manager</code>&#x7684;&#x5165;&#x53E3;&#x51FD;&#x6570;<code>Main</code>&#x51FD;&#x6570;&#xFF0C;&#x4ECD;&#x7136;&#x662F;&#x91C7;&#x7528;&#x7EDF;&#x4E00;&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#xFF0C;&#x4F7F;&#x7528;<a href="https://github.com/spf13/cobra" target="_blank">Cobra</a>&#x547D;&#x4EE4;&#x884C;&#x6846;&#x67B6;&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    command <span class="token operator">:=</span> app<span class="token punctuation">.</span><span class="token function">NewControllerManagerCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// TODO: once we switch everything over to Cobra commands, we can go back to calling</span>
    <span class="token comment">// utilflag.InitFlags() (by removing its pflag.Parse() call). For now, we have to set the</span>
    <span class="token comment">// normalize func and add the go flag set by hand.</span>
    pflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">.</span><span class="token function">SetNormalizeFunc</span><span class="token punctuation">(</span>utilflag<span class="token punctuation">.</span>WordSepNormalizeFunc<span class="token punctuation">)</span>
    pflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">.</span><span class="token function">AddGoFlagSet</span><span class="token punctuation">(</span>goflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">)</span>
    <span class="token comment">// utilflag.InitFlags()</span>
    logs<span class="token punctuation">.</span><span class="token function">InitLogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">defer</span> logs<span class="token punctuation">.</span><span class="token function">FlushLogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">:=</span> command<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// &#x521D;&#x59CB;&#x5316;&#x547D;&#x4EE4;&#x884C;&#x7ED3;&#x6784;&#x4F53;</span>
command <span class="token operator">:=</span> app<span class="token punctuation">.</span><span class="token function">NewControllerManagerCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// &#x6267;&#x884C;Execute</span>
err <span class="token operator">:=</span> command<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="2-newcontrollermanagercommand"><a name="2-newcontrollermanagercommand" class="anchor-navigation-ex-anchor" href="#2-newcontrollermanagercommand"><i class="fa fa-link" aria-hidden="true"></i></a>2. <a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/controllermanager.go#L77" target="_blank">NewControllerManagerCommand</a></h1>
<p>&#x8BE5;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x4F4D;&#x4E8E;&#xFF1A;<code>kubernetes/cmd/kube-controller-manager/app/controllermanager.go</code></p>
<pre class="language-"><code class="lang-go"><span class="token comment">// NewControllerManagerCommand creates a *cobra.Command object with default parameters</span>
<span class="token keyword">func</span> <span class="token function">NewControllerManagerCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    cmd <span class="token operator">:=</span> <span class="token operator">&amp;</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">{</span>
        Use<span class="token punctuation">:</span> <span class="token string">&quot;kube-controller-manager&quot;</span><span class="token punctuation">,</span>
        Long<span class="token punctuation">:</span> <span class="token string">`The Kubernetes controller manager is a daemon that embeds
the core control loops shipped with Kubernetes. In applications of robotics and
automation, a control loop is a non-terminating loop that regulates the state of
the system. In Kubernetes, a controller is a control loop that watches the shared
state of the cluster through the apiserver and makes changes attempting to move the
current state towards the desired state. Examples of controllers that ship with
Kubernetes today are the replication controller, endpoints controller, namespace
controller, and serviceaccounts controller.`</span><span class="token punctuation">,</span>
        Run<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>cmd <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">,</span> args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            verflag<span class="token punctuation">.</span><span class="token function">PrintAndExitIfRequested</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            utilflag<span class="token punctuation">.</span><span class="token function">PrintFlags</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            c<span class="token punctuation">,</span> err <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Config</span><span class="token punctuation">(</span><span class="token function">KnownControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ControllersDisabledByDefault<span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
                os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">Run</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">Complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wait<span class="token punctuation">.</span>NeverStop<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> <span class="token string">&quot;%v\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
                os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6784;&#x5EFA;&#x4E00;&#x4E2A;<code>*cobra.Command</code>&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;<code>Run</code>&#x51FD;&#x6570;&#x3002;</p>
<h2 id="21-newkubecontrollermanageroptions"><a name="21-newkubecontrollermanageroptions" class="anchor-navigation-ex-anchor" href="#21-newkubecontrollermanageroptions"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. NewKubeControllerManagerOptions</h2>
<pre class="language-"><code class="lang-go">s<span class="token punctuation">,</span> err <span class="token operator">:=</span> options<span class="token punctuation">.</span><span class="token function">NewKubeControllerManagerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    glog<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;unable to initialize command options: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x521D;&#x59CB;&#x5316;controllerManager&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x4E2D;&#x4E3B;&#x8981;&#x5305;&#x62EC;&#x4E86;&#x5404;&#x79CD;controller&#x7684;option&#xFF0C;&#x4F8B;&#x5982;<code>DeploymentControllerOptions</code>:</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// DeploymentControllerOptions holds the DeploymentController options.</span>
<span class="token keyword">type</span> DeploymentControllerOptions <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    ConcurrentDeploymentSyncs      <span class="token builtin">int32</span>
    DeploymentControllerSyncPeriod metav1<span class="token punctuation">.</span>Duration
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5177;&#x4F53;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// NewKubeControllerManagerOptions creates a new KubeControllerManagerOptions with a default config.</span>
<span class="token keyword">func</span> <span class="token function">NewKubeControllerManagerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>KubeControllerManagerOptions<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    componentConfig<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">NewDefaultComponentConfig</span><span class="token punctuation">(</span>ports<span class="token punctuation">.</span>InsecureKubeControllerManagerPort<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>

    s <span class="token operator">:=</span> KubeControllerManagerOptions<span class="token punctuation">{</span>
        Generic<span class="token punctuation">:</span>         cmoptions<span class="token punctuation">.</span><span class="token function">NewGenericControllerManagerConfigurationOptions</span><span class="token punctuation">(</span>componentConfig<span class="token punctuation">.</span>Generic<span class="token punctuation">)</span><span class="token punctuation">,</span>
        KubeCloudShared<span class="token punctuation">:</span> cmoptions<span class="token punctuation">.</span><span class="token function">NewKubeCloudSharedOptions</span><span class="token punctuation">(</span>componentConfig<span class="token punctuation">.</span>KubeCloudShared<span class="token punctuation">)</span><span class="token punctuation">,</span>
        AttachDetachController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>AttachDetachControllerOptions<span class="token punctuation">{</span>
            ReconcilerSyncLoopPeriod<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>AttachDetachController<span class="token punctuation">.</span>ReconcilerSyncLoopPeriod<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        CSRSigningController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>CSRSigningControllerOptions<span class="token punctuation">{</span>
            ClusterSigningCertFile<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>CSRSigningController<span class="token punctuation">.</span>ClusterSigningCertFile<span class="token punctuation">,</span>
            ClusterSigningKeyFile<span class="token punctuation">:</span>  componentConfig<span class="token punctuation">.</span>CSRSigningController<span class="token punctuation">.</span>ClusterSigningKeyFile<span class="token punctuation">,</span>
            ClusterSigningDuration<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>CSRSigningController<span class="token punctuation">.</span>ClusterSigningDuration<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        DaemonSetController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>DaemonSetControllerOptions<span class="token punctuation">{</span>
            ConcurrentDaemonSetSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>DaemonSetController<span class="token punctuation">.</span>ConcurrentDaemonSetSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        DeploymentController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>DeploymentControllerOptions<span class="token punctuation">{</span>
            ConcurrentDeploymentSyncs<span class="token punctuation">:</span>      componentConfig<span class="token punctuation">.</span>DeploymentController<span class="token punctuation">.</span>ConcurrentDeploymentSyncs<span class="token punctuation">,</span>
            DeploymentControllerSyncPeriod<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>DeploymentController<span class="token punctuation">.</span>DeploymentControllerSyncPeriod<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        DeprecatedFlags<span class="token punctuation">:</span> <span class="token operator">&amp;</span>DeprecatedControllerOptions<span class="token punctuation">{</span>
            RegisterRetryCount<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>DeprecatedController<span class="token punctuation">.</span>RegisterRetryCount<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        EndpointController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>EndpointControllerOptions<span class="token punctuation">{</span>
            ConcurrentEndpointSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>EndpointController<span class="token punctuation">.</span>ConcurrentEndpointSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        GarbageCollectorController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>GarbageCollectorControllerOptions<span class="token punctuation">{</span>
            ConcurrentGCSyncs<span class="token punctuation">:</span>      componentConfig<span class="token punctuation">.</span>GarbageCollectorController<span class="token punctuation">.</span>ConcurrentGCSyncs<span class="token punctuation">,</span>
            EnableGarbageCollector<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>GarbageCollectorController<span class="token punctuation">.</span>EnableGarbageCollector<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        HPAController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>HPAControllerOptions<span class="token punctuation">{</span>
            HorizontalPodAutoscalerSyncPeriod<span class="token punctuation">:</span>                   componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerSyncPeriod<span class="token punctuation">,</span>
            HorizontalPodAutoscalerUpscaleForbiddenWindow<span class="token punctuation">:</span>       componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerUpscaleForbiddenWindow<span class="token punctuation">,</span>
            HorizontalPodAutoscalerDownscaleForbiddenWindow<span class="token punctuation">:</span>     componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerDownscaleForbiddenWindow<span class="token punctuation">,</span>
            HorizontalPodAutoscalerDownscaleStabilizationWindow<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerDownscaleStabilizationWindow<span class="token punctuation">,</span>
            HorizontalPodAutoscalerCPUInitializationPeriod<span class="token punctuation">:</span>      componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerCPUInitializationPeriod<span class="token punctuation">,</span>
            HorizontalPodAutoscalerInitialReadinessDelay<span class="token punctuation">:</span>        componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerInitialReadinessDelay<span class="token punctuation">,</span>
            HorizontalPodAutoscalerTolerance<span class="token punctuation">:</span>                    componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerTolerance<span class="token punctuation">,</span>
            HorizontalPodAutoscalerUseRESTClients<span class="token punctuation">:</span>               componentConfig<span class="token punctuation">.</span>HPAController<span class="token punctuation">.</span>HorizontalPodAutoscalerUseRESTClients<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        JobController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>JobControllerOptions<span class="token punctuation">{</span>
            ConcurrentJobSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>JobController<span class="token punctuation">.</span>ConcurrentJobSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        NamespaceController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>NamespaceControllerOptions<span class="token punctuation">{</span>
            NamespaceSyncPeriod<span class="token punctuation">:</span>      componentConfig<span class="token punctuation">.</span>NamespaceController<span class="token punctuation">.</span>NamespaceSyncPeriod<span class="token punctuation">,</span>
            ConcurrentNamespaceSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>NamespaceController<span class="token punctuation">.</span>ConcurrentNamespaceSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        NodeIPAMController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>NodeIPAMControllerOptions<span class="token punctuation">{</span>
            NodeCIDRMaskSize<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>NodeIPAMController<span class="token punctuation">.</span>NodeCIDRMaskSize<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        NodeLifecycleController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>NodeLifecycleControllerOptions<span class="token punctuation">{</span>
            EnableTaintManager<span class="token punctuation">:</span>     componentConfig<span class="token punctuation">.</span>NodeLifecycleController<span class="token punctuation">.</span>EnableTaintManager<span class="token punctuation">,</span>
            NodeMonitorGracePeriod<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>NodeLifecycleController<span class="token punctuation">.</span>NodeMonitorGracePeriod<span class="token punctuation">,</span>
            NodeStartupGracePeriod<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>NodeLifecycleController<span class="token punctuation">.</span>NodeStartupGracePeriod<span class="token punctuation">,</span>
            PodEvictionTimeout<span class="token punctuation">:</span>     componentConfig<span class="token punctuation">.</span>NodeLifecycleController<span class="token punctuation">.</span>PodEvictionTimeout<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        PersistentVolumeBinderController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>PersistentVolumeBinderControllerOptions<span class="token punctuation">{</span>
            PVClaimBinderSyncPeriod<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>PersistentVolumeBinderController<span class="token punctuation">.</span>PVClaimBinderSyncPeriod<span class="token punctuation">,</span>
            VolumeConfiguration<span class="token punctuation">:</span>     componentConfig<span class="token punctuation">.</span>PersistentVolumeBinderController<span class="token punctuation">.</span>VolumeConfiguration<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        PodGCController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>PodGCControllerOptions<span class="token punctuation">{</span>
            TerminatedPodGCThreshold<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>PodGCController<span class="token punctuation">.</span>TerminatedPodGCThreshold<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ReplicaSetController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>ReplicaSetControllerOptions<span class="token punctuation">{</span>
            ConcurrentRSSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>ReplicaSetController<span class="token punctuation">.</span>ConcurrentRSSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ReplicationController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>ReplicationControllerOptions<span class="token punctuation">{</span>
            ConcurrentRCSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>ReplicationController<span class="token punctuation">.</span>ConcurrentRCSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ResourceQuotaController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>ResourceQuotaControllerOptions<span class="token punctuation">{</span>
            ResourceQuotaSyncPeriod<span class="token punctuation">:</span>      componentConfig<span class="token punctuation">.</span>ResourceQuotaController<span class="token punctuation">.</span>ResourceQuotaSyncPeriod<span class="token punctuation">,</span>
            ConcurrentResourceQuotaSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>ResourceQuotaController<span class="token punctuation">.</span>ConcurrentResourceQuotaSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        SAController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>SAControllerOptions<span class="token punctuation">{</span>
            ConcurrentSATokenSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>SAController<span class="token punctuation">.</span>ConcurrentSATokenSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ServiceController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>cmoptions<span class="token punctuation">.</span>ServiceControllerOptions<span class="token punctuation">{</span>
            ConcurrentServiceSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>ServiceController<span class="token punctuation">.</span>ConcurrentServiceSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        TTLAfterFinishedController<span class="token punctuation">:</span> <span class="token operator">&amp;</span>TTLAfterFinishedControllerOptions<span class="token punctuation">{</span>
            ConcurrentTTLSyncs<span class="token punctuation">:</span> componentConfig<span class="token punctuation">.</span>TTLAfterFinishedController<span class="token punctuation">.</span>ConcurrentTTLSyncs<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        SecureServing<span class="token punctuation">:</span> apiserveroptions<span class="token punctuation">.</span><span class="token function">NewSecureServingOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithLoopback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        InsecureServing<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>apiserveroptions<span class="token punctuation">.</span>DeprecatedInsecureServingOptions<span class="token punctuation">{</span>
            BindAddress<span class="token punctuation">:</span> net<span class="token punctuation">.</span><span class="token function">ParseIP</span><span class="token punctuation">(</span>componentConfig<span class="token punctuation">.</span>Generic<span class="token punctuation">.</span>Address<span class="token punctuation">)</span><span class="token punctuation">,</span>
            BindPort<span class="token punctuation">:</span>    <span class="token function">int</span><span class="token punctuation">(</span>componentConfig<span class="token punctuation">.</span>Generic<span class="token punctuation">.</span>Port<span class="token punctuation">)</span><span class="token punctuation">,</span>
            BindNetwork<span class="token punctuation">:</span> <span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithLoopback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Authentication<span class="token punctuation">:</span> apiserveroptions<span class="token punctuation">.</span><span class="token function">NewDelegatingAuthenticationOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Authorization<span class="token punctuation">:</span>  apiserveroptions<span class="token punctuation">.</span><span class="token function">NewDelegatingAuthorizationOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    s<span class="token punctuation">.</span>Authentication<span class="token punctuation">.</span>RemoteKubeConfigFileOptional <span class="token operator">=</span> <span class="token boolean">true</span>
    s<span class="token punctuation">.</span>Authorization<span class="token punctuation">.</span>RemoteKubeConfigFileOptional <span class="token operator">=</span> <span class="token boolean">true</span>
    s<span class="token punctuation">.</span>Authorization<span class="token punctuation">.</span>AlwaysAllowPaths <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;/healthz&quot;</span><span class="token punctuation">}</span>

    s<span class="token punctuation">.</span>SecureServing<span class="token punctuation">.</span>ServerCert<span class="token punctuation">.</span>CertDirectory <span class="token operator">=</span> <span class="token string">&quot;/var/run/kubernetes&quot;</span>
    s<span class="token punctuation">.</span>SecureServing<span class="token punctuation">.</span>ServerCert<span class="token punctuation">.</span>PairName <span class="token operator">=</span> <span class="token string">&quot;kube-controller-manager&quot;</span>
    s<span class="token punctuation">.</span>SecureServing<span class="token punctuation">.</span>BindPort <span class="token operator">=</span> ports<span class="token punctuation">.</span>KubeControllerManagerPort

    gcIgnoredResources <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>kubectrlmgrconfig<span class="token punctuation">.</span>GroupResource<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>garbagecollector<span class="token punctuation">.</span><span class="token function">DefaultIgnoredResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> r <span class="token operator">:=</span> <span class="token keyword">range</span> garbagecollector<span class="token punctuation">.</span><span class="token function">DefaultIgnoredResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        gcIgnoredResources <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>gcIgnoredResources<span class="token punctuation">,</span> kubectrlmgrconfig<span class="token punctuation">.</span>GroupResource<span class="token punctuation">{</span>Group<span class="token punctuation">:</span> r<span class="token punctuation">.</span>Group<span class="token punctuation">,</span> Resource<span class="token punctuation">:</span> r<span class="token punctuation">.</span>Resource<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    s<span class="token punctuation">.</span>GarbageCollectorController<span class="token punctuation">.</span>GCIgnoredResources <span class="token operator">=</span> gcIgnoredResources

    <span class="token keyword">return</span> <span class="token operator">&amp;</span>s<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="22-addflagset"><a name="22-addflagset" class="anchor-navigation-ex-anchor" href="#22-addflagset"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. AddFlagSet</h2>
<p>&#x6DFB;&#x52A0;&#x53C2;&#x6570;&#x53CA;&#x5E2E;&#x52A9;&#x51FD;&#x6570;&#x3002;</p>
<pre class="language-"><code class="lang-go">fs <span class="token operator">:=</span> cmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
namedFlagSets <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token function">KnownControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ControllersDisabledByDefault<span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> namedFlagSets<span class="token punctuation">.</span>FlagSets <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">AddFlagSet</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
usageFmt <span class="token operator">:=</span> <span class="token string">&quot;Usage:\n  %s\n&quot;</span>
cols<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> apiserverflag<span class="token punctuation">.</span><span class="token function">TerminalSize</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">OutOrStdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
cmd<span class="token punctuation">.</span><span class="token function">SetUsageFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>cmd <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">OutOrStderr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> usageFmt<span class="token punctuation">,</span> cmd<span class="token punctuation">.</span><span class="token function">UseLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    apiserverflag<span class="token punctuation">.</span><span class="token function">PrintSections</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">OutOrStderr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> namedFlagSets<span class="token punctuation">,</span> cols<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
cmd<span class="token punctuation">.</span><span class="token function">SetHelpFunc</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>cmd <span class="token operator">*</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">,</span> args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">OutOrStdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;%s\n\n&quot;</span><span class="token operator">+</span>usageFmt<span class="token punctuation">,</span> cmd<span class="token punctuation">.</span>Long<span class="token punctuation">,</span> cmd<span class="token punctuation">.</span><span class="token function">UseLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    apiserverflag<span class="token punctuation">.</span><span class="token function">PrintSections</span><span class="token punctuation">(</span>cmd<span class="token punctuation">.</span><span class="token function">OutOrStdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> namedFlagSets<span class="token punctuation">,</span> cols<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="3-run"><a name="3-run" class="anchor-navigation-ex-anchor" href="#3-run"><i class="fa fa-link" aria-hidden="true"></i></a>3. <a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/controllermanager.go#L141" target="_blank">Run</a></h1>
<blockquote>
<p>&#x6B64;&#x90E8;&#x5206;&#x7684;&#x4EE3;&#x7801;&#x4F4D;&#x4E8E;cmd/kube-controller-manager/app/controllermanager.go</p>
</blockquote>
<p>&#x57FA;&#x4E8E;<code>KubeControllerManagerOptions</code>&#x8FD0;&#x884C;controllerManager&#xFF0C;&#x4E0D;&#x9000;&#x51FA;&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// Run runs the KubeControllerManagerOptions.  This should never exit.</span>
<span class="token keyword">func</span> <span class="token function">Run</span><span class="token punctuation">(</span>c <span class="token operator">*</span>config<span class="token punctuation">.</span>CompletedConfig<span class="token punctuation">,</span> stopCh <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    run <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
        controllerContext<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">CreateControllerContext</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> rootClientBuilder<span class="token punctuation">,</span> clientBuilder<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            glog<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;error building controller context: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        saTokenControllerInitFunc <span class="token operator">:=</span> serviceAccountTokenControllerStarter<span class="token punctuation">{</span>rootClientBuilder<span class="token punctuation">:</span> rootClientBuilder<span class="token punctuation">}</span><span class="token punctuation">.</span>startServiceAccountTokenController

        <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">StartControllers</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">,</span> saTokenControllerInitFunc<span class="token punctuation">,</span> <span class="token function">NewControllerInitializers</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">.</span>LoopMode<span class="token punctuation">)</span><span class="token punctuation">,</span> unsecuredMux<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            glog<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;error starting controllers: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        controllerContext<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">.</span>Stop<span class="token punctuation">)</span>
        <span class="token function">close</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">.</span>InformersStarted<span class="token punctuation">)</span>

        <span class="token keyword">select</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Run&#x51FD;&#x6570;&#x6D89;&#x53CA;&#x7684;&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// &#x521B;&#x5EFA;controller&#x7684;context</span>
controllerContext<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">CreateControllerContext</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> rootClientBuilder<span class="token punctuation">,</span> clientBuilder<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &#x542F;&#x52A8;&#x5404;&#x79CD;controller</span>
err <span class="token operator">:=</span> <span class="token function">StartControllers</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">,</span> saTokenControllerInitFunc<span class="token punctuation">,</span> <span class="token function">NewControllerInitializers</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">.</span>LoopMode<span class="token punctuation">)</span><span class="token punctuation">,</span> unsecuredMux<span class="token punctuation">)</span>
</code></pre>
<p>&#x5176;&#x4E2D;<code>StartControllers</code>&#x4E2D;&#x7684;&#x5165;&#x53C2;<code>NewControllerInitializers</code>&#x521D;&#x59CB;&#x5316;&#x4E86;&#x5404;&#x79CD;controller&#x3002;</p>
<h2 id="31-createcontrollercontext"><a name="31-createcontrollercontext" class="anchor-navigation-ex-anchor" href="#31-createcontrollercontext"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. CreateControllerContext</h2>
<p><code>CreateControllerContext</code>&#x6784;&#x5EFA;&#x4E86;&#x5404;&#x79CD;controller&#x6240;&#x9700;&#x7684;&#x8D44;&#x6E90;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x5404;&#x79CD;controller&#x5728;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x5165;&#x53C2;&#x4E3A;&#x8BE5;context&#xFF0C;&#x5177;&#x4F53;&#x53C2;&#x8003;<code>initFn(ctx)</code>&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// CreateControllerContext creates a context struct containing references to resources needed by the</span>
<span class="token comment">// controllers such as the cloud provider and clientBuilder. rootClientBuilder is only used for</span>
<span class="token comment">// the shared-informers client and token controller.</span>
<span class="token keyword">func</span> <span class="token function">CreateControllerContext</span><span class="token punctuation">(</span>s <span class="token operator">*</span>config<span class="token punctuation">.</span>CompletedConfig<span class="token punctuation">,</span> rootClientBuilder<span class="token punctuation">,</span> clientBuilder controller<span class="token punctuation">.</span>ControllerClientBuilder<span class="token punctuation">,</span> stop <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ControllerContext<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    versionedClient <span class="token operator">:=</span> rootClientBuilder<span class="token punctuation">.</span><span class="token function">ClientOrDie</span><span class="token punctuation">(</span><span class="token string">&quot;shared-informers&quot;</span><span class="token punctuation">)</span>
    sharedInformers <span class="token operator">:=</span> informers<span class="token punctuation">.</span><span class="token function">NewSharedInformerFactory</span><span class="token punctuation">(</span>versionedClient<span class="token punctuation">,</span> <span class="token function">ResyncPeriod</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// If apiserver is not running we should wait for some time and fail only then. This is particularly</span>
    <span class="token comment">// important when we start apiserver and controller manager at the same time.</span>
    <span class="token keyword">if</span> err <span class="token operator">:=</span> genericcontrollermanager<span class="token punctuation">.</span><span class="token function">WaitForAPIServer</span><span class="token punctuation">(</span>versionedClient<span class="token punctuation">,</span> <span class="token number">10</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ControllerContext<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to wait for apiserver being healthy: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Use a discovery client capable of being refreshed.</span>
    discoveryClient <span class="token operator">:=</span> rootClientBuilder<span class="token punctuation">.</span><span class="token function">ClientOrDie</span><span class="token punctuation">(</span><span class="token string">&quot;controller-discovery&quot;</span><span class="token punctuation">)</span>
    cachedClient <span class="token operator">:=</span> cacheddiscovery<span class="token punctuation">.</span><span class="token function">NewMemCacheClient</span><span class="token punctuation">(</span>discoveryClient<span class="token punctuation">.</span><span class="token function">Discovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    restMapper <span class="token operator">:=</span> restmapper<span class="token punctuation">.</span><span class="token function">NewDeferredDiscoveryRESTMapper</span><span class="token punctuation">(</span>cachedClient<span class="token punctuation">)</span>
    <span class="token keyword">go</span> wait<span class="token punctuation">.</span><span class="token function">Until</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        restMapper<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span> stop<span class="token punctuation">)</span>

    availableResources<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">GetAvailableResources</span><span class="token punctuation">(</span>rootClientBuilder<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ControllerContext<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>

    cloud<span class="token punctuation">,</span> loopMode<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">createCloudProvider</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">.</span>KubeCloudShared<span class="token punctuation">.</span>CloudProvider<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> s<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">.</span>KubeCloudShared<span class="token punctuation">.</span>ExternalCloudVolumePlugin<span class="token punctuation">,</span>
        s<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">.</span>KubeCloudShared<span class="token punctuation">.</span>CloudProvider<span class="token punctuation">.</span>CloudConfigFile<span class="token punctuation">,</span> s<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">.</span>KubeCloudShared<span class="token punctuation">.</span>AllowUntaggedCloud<span class="token punctuation">,</span> sharedInformers<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ControllerContext<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>

    ctx <span class="token operator">:=</span> ControllerContext<span class="token punctuation">{</span>
        ClientBuilder<span class="token punctuation">:</span>      clientBuilder<span class="token punctuation">,</span>
        InformerFactory<span class="token punctuation">:</span>    sharedInformers<span class="token punctuation">,</span>
        ComponentConfig<span class="token punctuation">:</span>    s<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">,</span>
        RESTMapper<span class="token punctuation">:</span>         restMapper<span class="token punctuation">,</span>
        AvailableResources<span class="token punctuation">:</span> availableResources<span class="token punctuation">,</span>
        Cloud<span class="token punctuation">:</span>              cloud<span class="token punctuation">,</span>
        LoopMode<span class="token punctuation">:</span>           loopMode<span class="token punctuation">,</span>
        Stop<span class="token punctuation">:</span>               stop<span class="token punctuation">,</span>
        InformersStarted<span class="token punctuation">:</span>   <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ResyncPeriod<span class="token punctuation">:</span>       <span class="token function">ResyncPeriod</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ctx<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#x4E3A;<code>NewSharedInformerFactory</code>&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// &#x521B;&#x5EFA;SharedInformerFactory</span>
sharedInformers <span class="token operator">:=</span> informers<span class="token punctuation">.</span><span class="token function">NewSharedInformerFactory</span><span class="token punctuation">(</span>versionedClient<span class="token punctuation">,</span> <span class="token function">ResyncPeriod</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &#x8D4B;&#x503C;&#x7ED9;ControllerContext</span>
ctx <span class="token operator">:=</span> ControllerContext<span class="token punctuation">{</span>
    InformerFactory<span class="token punctuation">:</span>    sharedInformers<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>SharedInformerFactory</code>&#x63D0;&#x4F9B;&#x4E86;&#x516C;&#x5171;&#x7684;k8s&#x5BF9;&#x8C61;&#x7684;<code>informers</code>&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// SharedInformerFactory provides shared informers for resources in all known</span>
<span class="token comment">// API group versions.</span>
<span class="token keyword">type</span> SharedInformerFactory <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    internalinterfaces<span class="token punctuation">.</span>SharedInformerFactory
    <span class="token function">ForResource</span><span class="token punctuation">(</span>resource schema<span class="token punctuation">.</span>GroupVersionResource<span class="token punctuation">)</span> <span class="token punctuation">(</span>GenericInformer<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    <span class="token function">WaitForCacheSync</span><span class="token punctuation">(</span>stopCh <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span>reflect<span class="token punctuation">.</span>Type<span class="token punctuation">]</span><span class="token builtin">bool</span>

    <span class="token function">Admissionregistration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> admissionregistration<span class="token punctuation">.</span>Interface
    <span class="token function">Apps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> apps<span class="token punctuation">.</span>Interface
    <span class="token function">Autoscaling</span><span class="token punctuation">(</span><span class="token punctuation">)</span> autoscaling<span class="token punctuation">.</span>Interface
    <span class="token function">Batch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> batch<span class="token punctuation">.</span>Interface
    <span class="token function">Certificates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> certificates<span class="token punctuation">.</span>Interface
    <span class="token function">Coordination</span><span class="token punctuation">(</span><span class="token punctuation">)</span> coordination<span class="token punctuation">.</span>Interface
    <span class="token function">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span> core<span class="token punctuation">.</span>Interface
    <span class="token function">Events</span><span class="token punctuation">(</span><span class="token punctuation">)</span> events<span class="token punctuation">.</span>Interface
    <span class="token function">Extensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> extensions<span class="token punctuation">.</span>Interface
    <span class="token function">Networking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> networking<span class="token punctuation">.</span>Interface
    <span class="token function">Policy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> policy<span class="token punctuation">.</span>Interface
    <span class="token function">Rbac</span><span class="token punctuation">(</span><span class="token punctuation">)</span> rbac<span class="token punctuation">.</span>Interface
    <span class="token function">Scheduling</span><span class="token punctuation">(</span><span class="token punctuation">)</span> scheduling<span class="token punctuation">.</span>Interface
    <span class="token function">Settings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> settings<span class="token punctuation">.</span>Interface
    <span class="token function">Storage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> storage<span class="token punctuation">.</span>Interface
<span class="token punctuation">}</span>
</code></pre>
<h2 id="32-newcontrollerinitializers"><a name="32-newcontrollerinitializers" class="anchor-navigation-ex-anchor" href="#32-newcontrollerinitializers"><i class="fa fa-link" aria-hidden="true"></i></a>3.2. NewControllerInitializers</h2>
<p><code>NewControllerInitializers</code>&#x5B9A;&#x4E49;&#x4E86;&#x5404;&#x79CD;controller&#x7684;&#x7C7B;&#x578B;&#x548C;&#x5176;&#x5BF9;&#x4E8E;&#x7684;&#x542F;&#x52A8;&#x51FD;&#x6570;&#xFF0C;&#x4F8B;&#x5982;<code>deployment``&#x3001;statefulset</code>&#x3001;<code>replicaset</code>&#x3001;<code>replicationcontroller</code>&#x3001;<code>namespace</code>&#x7B49;&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// NewControllerInitializers is a public map of named controller groups (you can start more than one in an init func)</span>
<span class="token comment">// paired to their InitFunc.  This allows for structured downstream composition and subdivision.</span>
<span class="token keyword">func</span> <span class="token function">NewControllerInitializers</span><span class="token punctuation">(</span>loopMode ControllerLoopMode<span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>InitFunc <span class="token punctuation">{</span>
    controllers <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>InitFunc<span class="token punctuation">{</span><span class="token punctuation">}</span>
    controllers<span class="token punctuation">[</span><span class="token string">&quot;endpoint&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startEndpointController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;replicationcontroller&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startReplicationController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;podgc&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startPodGCController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;resourcequota&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startResourceQuotaController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;namespace&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startNamespaceController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;serviceaccount&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startServiceAccountController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;garbagecollector&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startGarbageCollectorController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;daemonset&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startDaemonSetController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;job&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startJobController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;deployment&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startDeploymentController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;replicaset&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startReplicaSetController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;horizontalpodautoscaling&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startHPAController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;disruption&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startDisruptionController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;statefulset&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startStatefulSetController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;cronjob&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startCronJobController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;csrsigning&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startCSRSigningController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;csrapproving&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startCSRApprovingController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;csrcleaner&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startCSRCleanerController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;ttl&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startTTLController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;bootstrapsigner&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startBootstrapSignerController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;tokencleaner&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startTokenCleanerController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;nodeipam&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startNodeIpamController
    <span class="token keyword">if</span> loopMode <span class="token operator">==</span> IncludeCloudLoops <span class="token punctuation">{</span>
        controllers<span class="token punctuation">[</span><span class="token string">&quot;service&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startServiceController
        controllers<span class="token punctuation">[</span><span class="token string">&quot;route&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startRouteController
        <span class="token comment">// TODO: volume controller into the IncludeCloudLoops only set.</span>
        <span class="token comment">// TODO: Separate cluster in cloud check from node lifecycle controller.</span>
    <span class="token punctuation">}</span>
    controllers<span class="token punctuation">[</span><span class="token string">&quot;nodelifecycle&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startNodeLifecycleController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;persistentvolume-binder&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startPersistentVolumeBinderController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;attachdetach&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startAttachDetachController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;persistentvolume-expander&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startVolumeExpandController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;clusterrole-aggregation&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startClusterRoleAggregrationController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;pvc-protection&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startPVCProtectionController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;pv-protection&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startPVProtectionController
    controllers<span class="token punctuation">[</span><span class="token string">&quot;ttl-after-finished&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startTTLAfterFinishedController

    <span class="token keyword">return</span> controllers
<span class="token punctuation">}</span>
</code></pre>
<h2 id="33-startcontrollers"><a name="33-startcontrollers" class="anchor-navigation-ex-anchor" href="#33-startcontrollers"><i class="fa fa-link" aria-hidden="true"></i></a>3.3. StartControllers</h2>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">StartControllers</span><span class="token punctuation">(</span>ctx ControllerContext<span class="token punctuation">,</span> startSATokenController InitFunc<span class="token punctuation">,</span> controllers <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>InitFunc<span class="token punctuation">,</span> unsecuredMux <span class="token operator">*</span>mux<span class="token punctuation">.</span>PathRecorderMux<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">for</span> controllerName<span class="token punctuation">,</span> initFn <span class="token operator">:=</span> <span class="token keyword">range</span> controllers <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token operator">!</span>ctx<span class="token punctuation">.</span><span class="token function">IsControllerEnabled</span><span class="token punctuation">(</span>controllerName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            glog<span class="token punctuation">.</span><span class="token function">Warningf</span><span class="token punctuation">(</span><span class="token string">&quot;%q is disabled&quot;</span><span class="token punctuation">,</span> controllerName<span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
        time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>wait<span class="token punctuation">.</span><span class="token function">Jitter</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">.</span>Generic<span class="token punctuation">.</span>ControllerStartInterval<span class="token punctuation">.</span>Duration<span class="token punctuation">,</span> ControllerStartJitter<span class="token punctuation">)</span><span class="token punctuation">)</span>

        glog<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">&quot;Starting %q&quot;</span><span class="token punctuation">,</span> controllerName<span class="token punctuation">)</span>
        debugHandler<span class="token punctuation">,</span> started<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">initFn</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            glog<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Error starting %q&quot;</span><span class="token punctuation">,</span> controllerName<span class="token punctuation">)</span>
            <span class="token keyword">return</span> err
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token operator">!</span>started <span class="token punctuation">{</span>
            glog<span class="token punctuation">.</span><span class="token function">Warningf</span><span class="token punctuation">(</span><span class="token string">&quot;Skipping %q&quot;</span><span class="token punctuation">,</span> controllerName<span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> debugHandler <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> unsecuredMux <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            basePath <span class="token operator">:=</span> <span class="token string">&quot;/debug/controllers/&quot;</span> <span class="token operator">+</span> controllerName
            unsecuredMux<span class="token punctuation">.</span><span class="token function">UnlistedHandle</span><span class="token punctuation">(</span>basePath<span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">StripPrefix</span><span class="token punctuation">(</span>basePath<span class="token punctuation">,</span> debugHandler<span class="token punctuation">)</span><span class="token punctuation">)</span>
            unsecuredMux<span class="token punctuation">.</span><span class="token function">UnlistedHandlePrefix</span><span class="token punctuation">(</span>basePath<span class="token operator">+</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> http<span class="token punctuation">.</span><span class="token function">StripPrefix</span><span class="token punctuation">(</span>basePath<span class="token punctuation">,</span> debugHandler<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        glog<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">&quot;Started %q&quot;</span><span class="token punctuation">,</span> controllerName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">for</span> controllerName<span class="token punctuation">,</span> initFn <span class="token operator">:=</span> <span class="token keyword">range</span> controllers <span class="token punctuation">{</span>
    debugHandler<span class="token punctuation">,</span> started<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">initFn</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x542F;&#x52A8;&#x5404;&#x79CD;controller&#xFF0C;controller&#x7684;&#x542F;&#x52A8;&#x51FD;&#x6570;&#x5728;<code>NewControllerInitializers</code>&#x4E2D;&#x5B9A;&#x4E49;&#x4E86;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// deployment</span>
controllers<span class="token punctuation">[</span><span class="token string">&quot;deployment&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startDeploymentController
<span class="token comment">// statefulset</span>
controllers<span class="token punctuation">[</span><span class="token string">&quot;statefulset&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> startStatefulSetController
</code></pre>
<h2 id="34-informerfactorystart"><a name="34-informerfactorystart" class="anchor-navigation-ex-anchor" href="#34-informerfactorystart"><i class="fa fa-link" aria-hidden="true"></i></a>3.4. InformerFactory.Start</h2>
<p><code>InformerFactory</code>&#x5B9E;&#x9645;&#x4E0A;&#x662F;<code>SharedInformerFactory</code>&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#x5728;<code>client-go</code>&#x4E2D;&#x7684;informer&#x7684;&#x5B9E;&#x73B0;&#x673A;&#x5236;&#x3002;</p>
<pre class="language-"><code class="lang-go">controllerContext<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">.</span>Stop<span class="token punctuation">)</span>
<span class="token function">close</span><span class="token punctuation">(</span>controllerContext<span class="token punctuation">.</span>InformersStarted<span class="token punctuation">)</span>
</code></pre>
<h3 id="341-sharedinformerfactory"><a name="341-sharedinformerfactory" class="anchor-navigation-ex-anchor" href="#341-sharedinformerfactory"><i class="fa fa-link" aria-hidden="true"></i></a>3.4.1. SharedInformerFactory</h3>
<p>SharedInformerFactory&#x662F;&#x4E00;&#x4E2A;informer&#x5DE5;&#x5382;&#x7684;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// SharedInformerFactory a small interface to allow for adding an informer without an import cycle</span>
<span class="token keyword">type</span> SharedInformerFactory <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Start</span><span class="token punctuation">(</span>stopCh <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">InformerFor</span><span class="token punctuation">(</span>obj runtime<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> newFunc NewInformerFunc<span class="token punctuation">)</span> cache<span class="token punctuation">.</span>SharedIndexInformer
<span class="token punctuation">}</span>
</code></pre>
<h3 id="342-sharedinformerfactorystart"><a name="342-sharedinformerfactorystart" class="anchor-navigation-ex-anchor" href="#342-sharedinformerfactorystart"><i class="fa fa-link" aria-hidden="true"></i></a>3.4.2. sharedInformerFactory.Start</h3>
<p>Start&#x65B9;&#x6CD5;&#x521D;&#x59CB;&#x5316;&#x5404;&#x79CD;&#x7C7B;&#x578B;&#x7684;informer</p>
<pre class="language-"><code class="lang-go"><span class="token comment">// Start initializes all requested informers.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>sharedInformerFactory<span class="token punctuation">)</span> <span class="token function">Start</span><span class="token punctuation">(</span>stopCh <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    f<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">defer</span> f<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> informerType<span class="token punctuation">,</span> informer <span class="token operator">:=</span> <span class="token keyword">range</span> f<span class="token punctuation">.</span>informers <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token operator">!</span>f<span class="token punctuation">.</span>startedInformers<span class="token punctuation">[</span>informerType<span class="token punctuation">]</span> <span class="token punctuation">{</span>
            <span class="token keyword">go</span> informer<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>stopCh<span class="token punctuation">)</span>
            f<span class="token punctuation">.</span>startedInformers<span class="token punctuation">[</span>informerType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="343-sharedindexinformerrun"><a name="343-sharedindexinformerrun" class="anchor-navigation-ex-anchor" href="#343-sharedindexinformerrun"><i class="fa fa-link" aria-hidden="true"></i></a>3.4.3. sharedIndexInformer.Run</h3>
<p>sharedIndexInformer.Run&#x5177;&#x4F53;&#x8FD0;&#x884C;&#x4E86;sharedIndexInformer&#x7684;&#x5B9E;&#x73B0;&#x903B;&#x8F91;&#xFF0C;&#x8BE5;&#x90E8;&#x5206;&#x5F85;&#x540E;&#x7EED;&#x5BF9;informer&#x673A;&#x5236;&#x505A;&#x4E13;&#x9898;&#x5206;&#x6790;&#x3002;</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>sharedIndexInformer<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span>stopCh <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">defer</span> utilruntime<span class="token punctuation">.</span><span class="token function">HandleCrash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    fifo <span class="token operator">:=</span> <span class="token function">NewDeltaFIFO</span><span class="token punctuation">(</span>MetaNamespaceKeyFunc<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>indexer<span class="token punctuation">)</span>

    cfg <span class="token operator">:=</span> <span class="token operator">&amp;</span>Config<span class="token punctuation">{</span>
        Queue<span class="token punctuation">:</span>            fifo<span class="token punctuation">,</span>
        ListerWatcher<span class="token punctuation">:</span>    s<span class="token punctuation">.</span>listerWatcher<span class="token punctuation">,</span>
        ObjectType<span class="token punctuation">:</span>       s<span class="token punctuation">.</span>objectType<span class="token punctuation">,</span>
        FullResyncPeriod<span class="token punctuation">:</span> s<span class="token punctuation">.</span>resyncCheckPeriod<span class="token punctuation">,</span>
        RetryOnError<span class="token punctuation">:</span>     <span class="token boolean">false</span><span class="token punctuation">,</span>
        ShouldResync<span class="token punctuation">:</span>     s<span class="token punctuation">.</span>processor<span class="token punctuation">.</span>shouldResync<span class="token punctuation">,</span>

        Process<span class="token punctuation">:</span> s<span class="token punctuation">.</span>HandleDeltas<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span>startedLock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">defer</span> s<span class="token punctuation">.</span>startedLock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        s<span class="token punctuation">.</span>controller <span class="token operator">=</span> <span class="token function">New</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>controller<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>controller<span class="token punctuation">)</span><span class="token punctuation">.</span>clock <span class="token operator">=</span> s<span class="token punctuation">.</span>clock
        s<span class="token punctuation">.</span>started <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Separate stop channel because Processor should be stopped strictly after controller</span>
    processorStopCh <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> wg wait<span class="token punctuation">.</span>Group
    <span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token comment">// Wait for Processor to stop</span>
    <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>processorStopCh<span class="token punctuation">)</span> <span class="token comment">// Tell Processor to stop</span>
    wg<span class="token punctuation">.</span><span class="token function">StartWithChannel</span><span class="token punctuation">(</span>processorStopCh<span class="token punctuation">,</span> s<span class="token punctuation">.</span>cacheMutationDetector<span class="token punctuation">.</span>Run<span class="token punctuation">)</span>
    wg<span class="token punctuation">.</span><span class="token function">StartWithChannel</span><span class="token punctuation">(</span>processorStopCh<span class="token punctuation">,</span> s<span class="token punctuation">.</span>processor<span class="token punctuation">.</span>run<span class="token punctuation">)</span>

    <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span>startedLock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">defer</span> s<span class="token punctuation">.</span>startedLock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>stopped <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// Don&apos;t want any new listeners</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>controller<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>stopCh<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="4-initfnctx"><a name="4-initfnctx" class="anchor-navigation-ex-anchor" href="#4-initfnctx"><i class="fa fa-link" aria-hidden="true"></i></a>4. initFn(ctx)</h1>
<p><code>initFn</code>&#x5B9E;&#x9645;&#x8C03;&#x7528;&#x7684;&#x5C31;&#x662F;&#x5404;&#x79CD;&#x7C7B;&#x578B;&#x7684;controller&#xFF0C;&#x4EE3;&#x7801;&#x4F4D;&#x4E8E;<code>kubernetes/cmd/kube-controller-manager/app/apps.go</code>&#xFF0C;&#x672C;&#x6587;&#x4EE5;<code>startStatefulSetController</code>&#x548C;<code>startDeploymentController</code>&#x4E3A;&#x4F8B;&#xFF0C;controller&#x4E2D;&#x5B9E;&#x9645;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x903B;&#x8F91;&#x4F4D;&#x4E8E;<code>kubernetes/pkg/controller</code>&#x4E2D;&#xFF0C;&#x5F85;&#x540E;&#x7EED;&#x5206;&#x6790;&#x3002;</p>
<h2 id="41-startstatefulsetcontroller"><a name="41-startstatefulsetcontroller" class="anchor-navigation-ex-anchor" href="#41-startstatefulsetcontroller"><i class="fa fa-link" aria-hidden="true"></i></a>4.1. <a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/apps.go#L55" target="_blank">startStatefulSetController</a></h2>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">startStatefulSetController</span><span class="token punctuation">(</span>ctx ControllerContext<span class="token punctuation">)</span> <span class="token punctuation">(</span>http<span class="token punctuation">.</span>Handler<span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>ctx<span class="token punctuation">.</span>AvailableResources<span class="token punctuation">[</span>schema<span class="token punctuation">.</span>GroupVersionResource<span class="token punctuation">{</span>Group<span class="token punctuation">:</span> <span class="token string">&quot;apps&quot;</span><span class="token punctuation">,</span> Version<span class="token punctuation">:</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> Resource<span class="token punctuation">:</span> <span class="token string">&quot;statefulsets&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">go</span> statefulset<span class="token punctuation">.</span><span class="token function">NewStatefulSetController</span><span class="token punctuation">(</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Apps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">StatefulSets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">PersistentVolumeClaims</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Apps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ControllerRevisions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>ClientBuilder<span class="token punctuation">.</span><span class="token function">ClientOrDie</span><span class="token punctuation">(</span><span class="token string">&quot;statefulset-controller&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>Stop<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x5176;&#x4E2D;&#x4F7F;&#x7528;&#x5230;&#x4E86;<code>InformerFactory</code>&#xFF0C;&#x5305;&#x542B;&#x4E86;Pods&#x3001;StatefulSets&#x3001;PersistentVolumeClaims&#x3001;ControllerRevisions&#x7684;informer&#x3002;</p>
<p><code>startStatefulSetController</code>&#x4E3B;&#x8981;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x4E3A;<code>NewStatefulSetController</code>&#x548C;&#x5BF9;&#x5E94;&#x7684;<code>Run</code>&#x51FD;&#x6570;&#x3002;</p>
<h2 id="42-startdeploymentcontroller"><a name="42-startdeploymentcontroller" class="anchor-navigation-ex-anchor" href="#42-startdeploymentcontroller"><i class="fa fa-link" aria-hidden="true"></i></a>4.2. <a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/apps.go#L82" target="_blank">startDeploymentController</a></h2>
<pre class="language-"><code class="lang-go"><span class="token keyword">func</span> <span class="token function">startDeploymentController</span><span class="token punctuation">(</span>ctx ControllerContext<span class="token punctuation">)</span> <span class="token punctuation">(</span>http<span class="token punctuation">.</span>Handler<span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>ctx<span class="token punctuation">.</span>AvailableResources<span class="token punctuation">[</span>schema<span class="token punctuation">.</span>GroupVersionResource<span class="token punctuation">{</span>Group<span class="token punctuation">:</span> <span class="token string">&quot;apps&quot;</span><span class="token punctuation">,</span> Version<span class="token punctuation">:</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span> Resource<span class="token punctuation">:</span> <span class="token string">&quot;deployments&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    dc<span class="token punctuation">,</span> err <span class="token operator">:=</span> deployment<span class="token punctuation">.</span><span class="token function">NewDeploymentController</span><span class="token punctuation">(</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Apps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Deployments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Apps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ReplicaSets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>InformerFactory<span class="token punctuation">.</span><span class="token function">Core</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">V1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ctx<span class="token punctuation">.</span>ClientBuilder<span class="token punctuation">.</span><span class="token function">ClientOrDie</span><span class="token punctuation">(</span><span class="token string">&quot;deployment-controller&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;error creating Deployment controller: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">go</span> dc<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>ComponentConfig<span class="token punctuation">.</span>DeploymentController<span class="token punctuation">.</span>ConcurrentDeploymentSyncs<span class="token punctuation">)</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>Stop<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>startDeploymentController</code>&#x4E3B;&#x8981;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x4E3A;<code>NewDeploymentController</code>&#x548C;&#x5BF9;&#x5E94;&#x7684;<code>Run</code>&#x51FD;&#x6570;&#x3002;&#x8BE5;&#x90E8;&#x5206;&#x903B;&#x8F91;&#x5728;<code>kubernetes/pkg/controller</code>&#x4E2D;&#x3002;</p>
<h1 id="5-&#x603B;&#x7ED3;"><a name="5-&#x603B;&#x7ED3;" class="anchor-navigation-ex-anchor" href="#5-&#x603B;&#x7ED3;"><i class="fa fa-link" aria-hidden="true"></i></a>5. &#x603B;&#x7ED3;</h1>
<ol>
<li>Kube-controller-manager&#x7684;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#x4ECD;&#x7136;&#x662F;<a href="https://github.com/spf13/cobra" target="_blank">Cobra</a>&#x547D;&#x4EE4;&#x884C;&#x6846;&#x67B6;&#x3002;&#x901A;&#x8FC7;&#x6784;&#x9020;<code>ControllerManagerCommand</code>&#xFF0C;&#x7136;&#x540E;&#x6267;&#x884C;<code>command.Execute()</code>&#x51FD;&#x6570;&#x3002;&#x57FA;&#x672C;&#x7684;&#x6D41;&#x7A0B;&#x5C31;&#x662F;&#x6784;&#x9020;option&#xFF0C;&#x6DFB;&#x52A0;Flags&#xFF0C;&#x6267;&#x884C;Run&#x51FD;&#x6570;&#x3002;</li>
<li>cmd&#x90E8;&#x5206;&#x7684;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;<code>Main--&gt;NewControllerManagerCommand--&gt; Run(c.Complete(), wait.NeverStop)--&gt;StartControllers--&gt;initFn(ctx)--&gt;startDeploymentController/startStatefulSetController--&gt;sts.NewStatefulSetController.Run/dc.NewDeploymentController.Run--&gt;pkg/controller</code>&#x3002;</li>
<li>&#x5176;&#x4E2D;<code>CreateControllerContext</code>&#x51FD;&#x6570;&#x7528;&#x6765;&#x521B;&#x5EFA;&#x5404;&#x7C7B;&#x578B;controller&#x6240;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7684;context&#xFF0C;<code>NewControllerInitializers</code>&#x521D;&#x59CB;&#x5316;&#x4E86;&#x5404;&#x79CD;&#x7C7B;&#x578B;&#x7684;controller&#xFF0C;&#x5176;&#x4E2D;&#x5C31;&#x5305;&#x62EC;<code>DeploymentController</code>&#x548C;<code>StatefulSetController</code>&#x7B49;&#x3002;</li>
</ol>
<p>&#x57FA;&#x672C;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li>&#x6784;&#x9020;controller manager option&#xFF0C;&#x5E76;&#x8F6C;&#x5316;&#x4E3A;Config&#x5BF9;&#x8C61;&#xFF0C;&#x6267;&#x884C;Run&#x51FD;&#x6570;&#x3002;</li>
<li>&#x57FA;&#x4E8E;Config&#x5BF9;&#x8C61;&#x521B;&#x5EFA;ControllerContext&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;InformerFactory&#x3002;</li>
<li>&#x57FA;&#x4E8E;ControllerContext&#x8FD0;&#x884C;&#x5404;&#x79CD;controller&#xFF0C;&#x5404;&#x79CD;controller&#x7684;&#x5B9A;&#x4E49;&#x5728;<code>NewControllerInitializers</code>&#x4E2D;&#x3002;</li>
<li>&#x6267;&#x884C;InformerFactory.Start&#x3002;</li>
<li>&#x6BCF;&#x79CD;controller&#x90FD;&#x4F1A;&#x6784;&#x9020;&#x81EA;&#x8EAB;&#x7684;&#x7ED3;&#x6784;&#x4F53;&#x5E76;&#x6267;&#x884C;&#x5BF9;&#x5E94;&#x7684;Run&#x51FD;&#x6570;&#x3002;</li>
</ol>
<p>&#x53C2;&#x8003;&#xFF1A;</p>
<ul>
<li><a href="https://github.com/kubernetes/kubernetes/tree/v1.12.0/cmd/kube-controller-manager" target="_blank">https://github.com/kubernetes/kubernetes/tree/v1.12.0/cmd/kube-controller-manager</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/controller-manager.go" target="_blank">https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/controller-manager.go</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/controllermanager.go" target="_blank">https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/controllermanager.go</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/apps.go" target="_blank">https://github.com/kubernetes/kubernetes/blob/v1.12.0/cmd/kube-controller-manager/app/apps.go</a></li>
</ul>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; www.huweihuang.com all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">Updated at 
2022-12-29 21:24:00
</span></footer>
                </div>
                <script src="https://my.openwrite.cn/js/readmore.js"></script>
                <script>
                    var enablePlugin = false;
                    var allowDomain = ["www.huweihuang.com","localhost"];
                    if(allowDomain){
                        var currentDomain = location.hostname;
                        if ($.isArray(allowDomain)) {
                            $.each(allowDomain, function(index, item) {
                                if (currentDomain == item) {
                                    enablePlugin = true;
                                    return false;
                                }
                            });
                        }else{
                           if (currentDomain == allowDomain) {
                                enablePlugin = true;
                            }
                        }
                    }else{
                        enablePlugin = true;
                    }
                    
                    if(enablePlugin){
                        var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
                        if (!isMobile) {
                            var btw = new BTWPlugin();
                            btw.init({"allowDomain":["www.huweihuang.com","localhost"],"blogId":"30679-1666624938200-328","name":"容器云架构","qrcode":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1551600382/blog/wechat-public-acconut.jpg","keyword":"k8s","id":"vip-container"});
                        }
                    }
                </script>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="_index.html" class="navigation navigation-prev " aria-label="Previous page: kube-controller-manager">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="deployment-controller.html" class="navigation navigation-next " aria-label="Next page: DeploymentController">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"NewControllerManagerCommand","level":"12.3.1","depth":2,"next":{"title":"DeploymentController","level":"12.3.2","depth":2,"path":"code-analysis/kube-controller-manager/deployment-controller.md","ref":"code-analysis/kube-controller-manager/deployment-controller.md","articles":[]},"previous":{"title":"kube-controller-manager","level":"12.3","depth":1,"path":"code-analysis/kube-controller-manager/_index.md","ref":"code-analysis/kube-controller-manager/_index.md","articles":[{"title":"NewControllerManagerCommand","level":"12.3.1","depth":2,"path":"code-analysis/kube-controller-manager/NewControllerManagerCommand.md","ref":"code-analysis/kube-controller-manager/NewControllerManagerCommand.md","articles":[]},{"title":"DeploymentController","level":"12.3.2","depth":2,"path":"code-analysis/kube-controller-manager/deployment-controller.md","ref":"code-analysis/kube-controller-manager/deployment-controller.md","articles":[]},{"title":"Informer机制","level":"12.3.3","depth":2,"path":"code-analysis/kube-controller-manager/sharedIndexInformer.md","ref":"code-analysis/kube-controller-manager/sharedIndexInformer.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["github","codesnippet","splitter","anchor-navigation-ex","image-captions","editlink","-lunr","-search","search-plus","github-buttons@2.1.0","favicon@^0.0.2","tbfed-pagefooter@^0.0.1","3-ba","theme-huweihuang","-highlight","prism","prism-themes","sitemap-general","ga","disqus","donate","expandable-chapters","readmore"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright © www.huweihuang.com","modify_label":"Updated at ","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prismjs/themes/prism-okaidia.css"]},"disqus":{"useIdentifier":false,"shortName":"huweihuang"},"theme-huweihuang":{"showLevel":true,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"googleAdsenseClient":"ca-pub-8205636531078391"},"github":{"url":"https://github.com/huweihuang"},"editlink":{"label":"编辑本页","multilingual":false,"base":"https://github.com/huweihuang/kubernetes-notes/blob/master/"},"splitter":{},"readmore":{"allowDomain":["www.huweihuang.com","localhost"],"blogId":"30679-1666624938200-328","name":"容器云架构","qrcode":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1551600382/blog/wechat-public-acconut.jpg","keyword":"k8s"},"donate":{"alipay":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1551599640/blog/donate/alipay.jpg","alipayText":"支付宝打赏","button":"赏","title":"","wechat":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1551599472/blog/donate/wechatpay.jpg","wechatText":"微信打赏"},"codesnippet":{},"sitemap-general":{"prefix":"https://www.huweihuang.com/kubernetes-notes/"},"fontsettings":{"theme":"white","family":"sans","size":2},"anchor-navigation-ex":{"showLevelIcon":false,"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"showLevel":false,"tocLevel1Icon":"fa fa-hand-o-right","tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"printLog":false,"multipleH1":false,"multipleH2":false,"associatedWithSummary":true,"multipleH3":false,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"multipleH4":false},"favicon":{"shortcut":"images/favicon.ico","bookmark":"images/favicon.ico","appleTouch":"images/favicon.ico","appleTouchMore":{"120x120":"images/favicon.ico","180x180":"images/favicon.ico"}},"prism-themes":{},"github-buttons":{"repo":"huweihuang/kubernetes-notes","types":["star"],"size":"small"},"3-ba":{"configuration":"auto","token":"e146d71b77957235bba1e709d930f62e"},"ga":{"configuration":"auto","token":"UA-114718458-2"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"showLevel":false,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"expandable-chapters":{},"search-plus":{},"image-captions":{"caption":"图片 - _CAPTION_","variable_name":"_pictures"}},"theme":"default","author":"胡伟煌","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"_pictures":[{"backlink":"paas/k8s.html#fig2.2.1","level":"2.2","list_caption":"Figure: k8s体系","alt":"k8s体系","nro":1,"url":"http://assets.processon.com/chart_image/5d7f7cafe4b08987f55cbee3.png","index":1,"caption_template":"图片 - _CAPTION_","label":"k8s体系","attributes":{},"skip":false,"key":"2.2.1"},{"backlink":"concepts/object/kubernetes-basic-concepts.html#fig4.2.2.1","level":"4.2.2","list_caption":"Figure: pod","alt":"pod","nro":2,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578930/article/kubernetes/concept/pod.png","index":1,"caption_template":"图片 - _CAPTION_","label":"pod","attributes":{},"skip":false,"key":"4.2.2.1"},{"backlink":"concepts/object/kubernetes-basic-concepts.html#fig4.2.2.2","level":"4.2.2","list_caption":"Figure: pod2","alt":"pod2","nro":3,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578930/article/kubernetes/concept/pod2.png","index":2,"caption_template":"图片 - _CAPTION_","label":"pod2","attributes":{},"skip":false,"key":"4.2.2.2"},{"backlink":"concepts/object/kubernetes-basic-concepts.html#fig4.2.2.3","level":"4.2.2","list_caption":"Figure: service","alt":"service","nro":4,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578930/article/kubernetes/concept/service.png","index":3,"caption_template":"图片 - _CAPTION_","label":"service","attributes":{},"skip":false,"key":"4.2.2.3"},{"backlink":"concepts/pod/pod-volume.html#fig4.3.5.1","level":"4.3.5","list_caption":"Figure: 这里写图片描述","alt":"这里写图片描述","nro":5,"url":"http://res.cloudinary.com/dqxtn0ick/image/upload/v1512804287/article/kubernetes/pod/pod_volume.png","index":1,"caption_template":"图片 - _CAPTION_","label":"这里写图片描述","attributes":{},"skip":false,"key":"4.3.5.1"},{"backlink":"concepts/pod/pod-scheduler.html#fig4.3.6.1","level":"4.3.6","list_caption":"Figure: 这里写图片描述","alt":"这里写图片描述","nro":6,"url":"http://res.cloudinary.com/dqxtn0ick/image/upload/v1512804287/article/kubernetes/pod/monitor_pod.png","index":1,"caption_template":"图片 - _CAPTION_","label":"这里写图片描述","attributes":{},"skip":false,"key":"4.3.6.1"},{"backlink":"concepts/pod/pod-scheduler.html#fig4.3.6.2","level":"4.3.6","list_caption":"Figure: 这里写图片描述","alt":"这里写图片描述","nro":7,"url":"http://res.cloudinary.com/dqxtn0ick/image/upload/v1512804286/article/kubernetes/pod/k8s_job.png","index":2,"caption_template":"图片 - _CAPTION_","label":"这里写图片描述","attributes":{},"skip":false,"key":"4.3.6.2"},{"backlink":"principle/component/kubernetes-core-principle-api-server.html#fig5.1.1.1","level":"5.1.1","list_caption":"Figure: kube-apiserver","alt":"kube-apiserver","nro":8,"url":"http://res.cloudinary.com/dqxtn0ick/image/upload/v1510579017/article/kubernetes/core/kube-apiserver.png","index":1,"caption_template":"图片 - _CAPTION_","label":"kube-apiserver","attributes":{},"skip":false,"key":"5.1.1.1"},{"backlink":"principle/component/kubernetes-core-principle-controller-manager.html#fig5.1.2.1","level":"5.1.2","list_caption":"Figure: controller manager","alt":"controller manager","nro":9,"url":"http://res.cloudinary.com/dqxtn0ick/image/upload/v1510579017/article/kubernetes/core/controller-manager.png","index":1,"caption_template":"图片 - _CAPTION_","label":"controller manager","attributes":{},"skip":false,"key":"5.1.2.1"},{"backlink":"principle/component/kubernetes-core-principle-controller-manager.html#fig5.1.2.2","level":"5.1.2","list_caption":"Figure: Node Controller","alt":"Node Controller","nro":10,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510579017/article/kubernetes/core/NodeController.png","index":2,"caption_template":"图片 - _CAPTION_","label":"Node Controller","attributes":{},"skip":false,"key":"5.1.2.2"},{"backlink":"principle/component/kubernetes-core-principle-controller-manager.html#fig5.1.2.3","level":"5.1.2","list_caption":"Figure: ResourceQuota Controller","alt":"ResourceQuota Controller","nro":11,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510579017/article/kubernetes/core/ResourceQuotaController.png","index":3,"caption_template":"图片 - _CAPTION_","label":"ResourceQuota Controller","attributes":{},"skip":false,"key":"5.1.2.3"},{"backlink":"principle/component/kubernetes-core-principle-controller-manager.html#fig5.1.2.4","level":"5.1.2","list_caption":"Figure: Endpoint Controller","alt":"Endpoint Controller","nro":12,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510579017/article/kubernetes/core/EndpointController.png","index":4,"caption_template":"图片 - _CAPTION_","label":"Endpoint Controller","attributes":{},"skip":false,"key":"5.1.2.4"},{"backlink":"principle/component/kubernetes-core-principle-scheduler.html#fig5.1.3.1","level":"5.1.3","list_caption":"Figure: scheduler","alt":"scheduler","nro":13,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510579017/article/kubernetes/core/scheduler.png","index":1,"caption_template":"图片 - _CAPTION_","label":"scheduler","attributes":{},"skip":false,"key":"5.1.3.1"},{"backlink":"network/docker-network.html#fig6.1.1","level":"6.1","list_caption":"Figure: 这里写图片描述","alt":"这里写图片描述","nro":14,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578957/article/kubernetes/network/container-network.png","index":1,"caption_template":"图片 - _CAPTION_","label":"这里写图片描述","attributes":{},"skip":false,"key":"6.1.1"},{"backlink":"network/docker-network.html#fig6.1.2","level":"6.1","list_caption":"Figure: 这里写图片描述","alt":"这里写图片描述","nro":15,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578957/article/kubernetes/network/bridge.png","index":2,"caption_template":"图片 - _CAPTION_","label":"这里写图片描述","attributes":{},"skip":false,"key":"6.1.2"},{"backlink":"network/kubernetes-network.html#fig6.2.1","level":"6.2","list_caption":"Figure: 这里写图片描述","alt":"这里写图片描述","nro":16,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578957/article/kubernetes/network/network-arch.png","index":1,"caption_template":"图片 - _CAPTION_","label":"这里写图片描述","attributes":{},"skip":false,"key":"6.2.1"},{"backlink":"network/kubernetes-network.html#fig6.2.2","level":"6.2","list_caption":"Figure: 这里写图片描述","alt":"这里写图片描述","nro":17,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578957/article/kubernetes/network/pod-network.png","index":2,"caption_template":"图片 - _CAPTION_","label":"这里写图片描述","attributes":{},"skip":false,"key":"6.2.2"},{"backlink":"network/flannel/flannel-introduction.html#fig6.4.1.1","level":"6.4.1","list_caption":"Figure: 动态路由","alt":"动态路由","nro":18,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578568/article/flannel/dynamic-route.png","index":1,"caption_template":"图片 - _CAPTION_","label":"动态路由","attributes":{},"skip":false,"key":"6.4.1.1"},{"backlink":"network/flannel/flannel-introduction.html#fig6.4.1.2","level":"6.4.1","list_caption":"Figure: flannel","alt":"flannel","nro":19,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578568/article/flannel/flannel.png","index":2,"caption_template":"图片 - _CAPTION_","label":"flannel","attributes":{},"skip":false,"key":"6.4.1.2"},{"backlink":"network/flannel/flannel-introduction.html#fig6.4.1.3","level":"6.4.1","list_caption":"Figure: UDP封装","alt":"UDP封装","nro":20,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578569/article/flannel/udp.png","index":3,"caption_template":"图片 - _CAPTION_","label":"UDP封装","attributes":{},"skip":false,"key":"6.4.1.3"},{"backlink":"network/flannel/flannel-introduction.html#fig6.4.1.4","level":"6.4.1","list_caption":"Figure: docker启动参数","alt":"docker启动参数","nro":21,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578568/article/flannel/docker-init-args.png","index":4,"caption_template":"图片 - _CAPTION_","label":"docker启动参数","attributes":{},"skip":false,"key":"6.4.1.4"},{"backlink":"network/flannel/flannel-introduction.html#fig6.4.1.5","level":"6.4.1","list_caption":"Figure: 数据发送节点路由表","alt":"数据发送节点路由表","nro":22,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578568/article/flannel/DataSendRouteTable.png","index":5,"caption_template":"图片 - _CAPTION_","label":"数据发送节点路由表","attributes":{},"skip":false,"key":"6.4.1.5"},{"backlink":"network/flannel/flannel-introduction.html#fig6.4.1.6","level":"6.4.1","list_caption":"Figure: 数据接收节点路由表","alt":"数据接收节点路由表","nro":23,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578568/article/flannel/DataReceiveRouteTable.png","index":6,"caption_template":"图片 - _CAPTION_","label":"数据接收节点路由表","attributes":{},"skip":false,"key":"6.4.1.6"},{"backlink":"resource/lxcfs/lxcfs.html#fig8.4.1","level":"8.4","list_caption":"Figure: lxcfs","alt":"lxcfs","nro":24,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1626002975/article/kubernetes/resource/lxcfs/lxcfs.webp","index":1,"caption_template":"图片 - _CAPTION_","label":"lxcfs","attributes":{},"skip":false,"key":"8.4.1"},{"backlink":"trouble-shooting/node/cgroup-subsystem-not-mount.html#fig11.1.3.1","level":"11.1.3","list_caption":"Figure: kubelet","alt":"kubelet","nro":25,"url":"../../images/troubleshooting/cgroup-not-mount.png","index":1,"caption_template":"图片 - _CAPTION_","label":"kubelet","attributes":{},"skip":false,"key":"11.1.3.1"},{"backlink":"runtime/runtime.html#fig13.1.1.1","level":"13.1.1","list_caption":"Figure: 关系图","alt":"关系图","nro":26,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1631845163/article/kubernetes/containerd/runtime.webp","index":1,"caption_template":"图片 - _CAPTION_","label":"关系图","attributes":{},"skip":false,"key":"13.1.1.1"},{"backlink":"etcd/etcd-introduction.html#fig14.1.1","level":"14.1","list_caption":"Figure: etcd的架构图","alt":"etcd的架构图","nro":27,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578532/article/etcd/etcd-architecture.jpg","index":1,"caption_template":"图片 - _CAPTION_","label":"etcd的架构图","attributes":{},"skip":false,"key":"14.1.1"},{"backlink":"etcd/raft.html#fig14.2.1","level":"14.2","list_caption":"Figure: raft","alt":"raft","nro":28,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510578532/article/etcd/raft.png","index":1,"caption_template":"图片 - _CAPTION_","label":"raft","attributes":{},"skip":false,"key":"14.2.1"},{"backlink":"multi-cluster/karmada/karmada-introduction.html#fig15.3.1.1","level":"15.3.1","list_caption":"Figure: img","alt":"img","nro":29,"url":"https://support.huaweicloud.com/productdesc-mcp/zh-cn_image_0000001094636778.png","index":1,"caption_template":"图片 - _CAPTION_","label":"img","attributes":{},"skip":false,"key":"15.3.1.1"},{"backlink":"multi-cluster/karmada/karmada-introduction.html#fig15.3.1.2","level":"15.3.1","list_caption":"Figure: img","alt":"img","nro":30,"url":"https://support.huaweicloud.com/productdesc-mcp/zh-cn_image_0000001141316765.png","index":2,"caption_template":"图片 - _CAPTION_","label":"img","attributes":{},"skip":false,"key":"15.3.1.2"},{"backlink":"edge/kubeedge/kubeedge-arch.html#fig16.1.1","level":"16.1","list_caption":"Figure: kubeedge-arch","alt":"kubeedge-arch","nro":31,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1580806242/article/kubernetes/kubeedge/kubeedge_arch.png","index":1,"caption_template":"图片 - _CAPTION_","label":"kubeedge-arch","attributes":{},"skip":false,"key":"16.1.1"},{"backlink":"kvm/kubevirt/kubevirt-introduction.html#fig17.2.1.1","level":"17.2.1","list_caption":"Figure: arch","alt":"arch","nro":32,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1650005691/article/kubernetes/kubevirt/architecture.png","index":1,"caption_template":"图片 - _CAPTION_","label":"arch","attributes":{},"skip":false,"key":"17.2.1.1"},{"backlink":"monitor/kubernetes-cluster-monitoring.html#fig18.1.1","level":"18.1","list_caption":"Figure: k8s监控架构图","alt":"k8s监控架构图","nro":33,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510579058/article/kubernetes/monitor/k8s-monitor-arch.png","index":1,"caption_template":"图片 - _CAPTION_","label":"k8s监控架构图","attributes":{},"skip":false,"key":"18.1.1"},{"backlink":"monitor/cadvisor-introduction.html#fig18.3.1","level":"18.3","list_caption":"Figure: cAdvisor","alt":"cAdvisor","nro":34,"url":"https://res.cloudinary.com/dqxtn0ick/image/upload/v1510579058/article/kubernetes/monitor/cAdvisor.png","index":1,"caption_template":"图片 - _CAPTION_","label":"cAdvisor","attributes":{},"skip":false,"key":"18.3.1"}]},"title":"Kubernetes 学习笔记","language":"zh-hans","links":{"sidebar":{"Golang 学习笔记":"https://www.huweihuang.com/golang-notes/","Linux 学习笔记":"https://www.huweihuang.com/linux-notes/","Blockchain 学习笔记":"https://www.huweihuang.com/blockchain-notes/","数据结构学习笔记":"https://www.huweihuang.com/data-structure-notes/","Kubernetes 学习笔记":"https://www.huweihuang.com/kubernetes-notes/","Kubernetes 源码分析笔记":"https://www.huweihuang.com/k8s-source-code-analysis/","Docker 学习笔记":"https://www.huweihuang.com/docker-notes/","Python 学习笔记":"https://www.huweihuang.com/python-notes/","胡伟煌的博客":"https://www.huweihuang.com"}},"gitbook":"*","description":"Kubernetes 学习笔记"},"file":{"path":"code-analysis/kube-controller-manager/NewControllerManagerCommand.md","mtime":"2022-12-29T13:24:00.260Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-07-04T01:41:22.089Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-editlink/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-3-ba/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

